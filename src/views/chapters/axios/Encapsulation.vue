<template>
  <div class="knowledge-page">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="page-header">
      <h1>ğŸ“¦ Axios å°è£…å®è·µ</h1>
      <p class="subtitle">é¡¹ç›®çº§åˆ«çš„è¯·æ±‚å°è£…ä¸ API ç®¡ç†æœ€ä½³å®è·µ</p>
    </div>

    <!-- æ¦‚å¿µè¯´æ˜ -->
    <KnowledgeCard title="ğŸ“– æ¦‚å¿µè¯´æ˜ï¼ˆæ˜¯ä»€ä¹ˆï¼‰">
      <div class="concept-content">
        <p><strong>Axios å°è£…</strong> å°±åƒå»ºä¸€ä¸ªã€Œå¿«é€’é©¿ç«™ã€ï¼š</p>
        <ul>
          <li>ğŸ“® <strong>ç»Ÿä¸€å…¥å£</strong>ï¼šæ‰€æœ‰å¿«é€’éƒ½ä»é©¿ç«™å‘å‡ºï¼Œä¸ç”¨è‡ªå·±è·‘å¿«é€’å…¬å¸</li>
          <li>ğŸ“‹ <strong>æ ‡å‡†åŒ–æµç¨‹</strong>ï¼šå¯„ä»¶å•æ ¼å¼ç»Ÿä¸€ã€æ”¶è´¹æ ‡å‡†ç»Ÿä¸€</li>
          <li>ğŸ”§ <strong>å¢å€¼æœåŠ¡</strong>ï¼šè‡ªåŠ¨åŒ…è£…ã€è‡ªåŠ¨ä¿ä»·ã€å¼‚å¸¸å¤„ç†</li>
          <li>ğŸ“Š <strong>å¯è¿½æº¯</strong>ï¼šæ‰€æœ‰è®°å½•éƒ½åœ¨é©¿ç«™ç³»ç»Ÿé‡Œ</li>
        </ul>
        
        <div class="highlight-box">
          <h4>ğŸ’¡ ä¸ºä»€ä¹ˆè¦å°è£…ï¼Ÿ</h4>
          <p>ç›´æ¥ç”¨ axios ä¼šå¯¼è‡´ï¼šé‡å¤ä»£ç å¤šã€éš¾ä»¥ç»Ÿä¸€ç®¡ç†ã€ä¿®æ”¹æˆæœ¬é«˜ã€‚</p>
          <p>å°è£…åï¼šä¸€å¤„ä¿®æ”¹ã€å¤„å¤„ç”Ÿæ•ˆï¼Œä»£ç æ•´æ´ã€æ˜“äºç»´æŠ¤ã€‚</p>
        </div>
      </div>
    </KnowledgeCard>

    <!-- å°è£…æ¶æ„ -->
    <KnowledgeCard title="ğŸ—ï¸ å°è£…æ¶æ„">
      <div class="architecture-diagram">
        <pre class="structure-tree">
src/
â”œâ”€â”€ api/                    # API æ¨¡å—ç›®å½•
â”‚   â”œâ”€â”€ index.js           # ç»Ÿä¸€å¯¼å‡º
â”‚   â”œâ”€â”€ user.js            # ç”¨æˆ·ç›¸å…³ API
â”‚   â”œâ”€â”€ product.js         # å•†å“ç›¸å…³ API
â”‚   â””â”€â”€ order.js           # è®¢å•ç›¸å…³ API
â”‚
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ request.js         # Axios å®ä¾‹å°è£…
â”‚
â””â”€â”€ config/
    â””â”€â”€ index.js           # é…ç½®æ–‡ä»¶ï¼ˆbaseURL ç­‰ï¼‰
        </pre>
      </div>
      
      <div class="layer-description">
        <div class="layer">
          <span class="layer-name">ğŸ”§ request.js</span>
          <span class="layer-desc">åº•å±‚ï¼šåˆ›å»º Axios å®ä¾‹ï¼Œé…ç½®æ‹¦æˆªå™¨</span>
        </div>
        <div class="layer">
          <span class="layer-name">ğŸ“ api/*.js</span>
          <span class="layer-desc">ä¸­å±‚ï¼šæŒ‰æ¨¡å—ç»„ç»‡å…·ä½“çš„ API å‡½æ•°</span>
        </div>
        <div class="layer">
          <span class="layer-name">ğŸ–¥ï¸ ç»„ä»¶</span>
          <span class="layer-desc">ä¸Šå±‚ï¼šè°ƒç”¨ API å‡½æ•°ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘</span>
        </div>
      </div>
    </KnowledgeCard>

    <!-- æ ¸å¿ƒå°è£…ä»£ç  -->
    <KnowledgeCard title="ğŸ“ æ ¸å¿ƒå°è£…ä»£ç ">
      <div class="code-section">
        <h4>1. request.js - Axios å®ä¾‹</h4>
        <CodeBlock :code="requestCode" language="javascript" />
        
        <h4 class="mt-lg">2. api/user.js - ç”¨æˆ·æ¨¡å—</h4>
        <CodeBlock :code="userApiCode" language="javascript" />
        
        <h4 class="mt-lg">3. ç»„ä»¶ä¸­ä½¿ç”¨</h4>
        <CodeBlock :code="usageCode" language="javascript" />
      </div>
    </KnowledgeCard>

    <!-- åŸºç¡€ç¤ºä¾‹ -->
    <KnowledgeCard title="ğŸ¯ åŸºç¡€ç¤ºä¾‹">
      <DemoBox 
        demoPath="axios/encapsulation-basic"
        title="Demo 1: åŸºç¡€å°è£…ç»“æ„"
        description="å±•ç¤º request.js çš„åŸºæœ¬å°è£…æ–¹å¼"
        height="420px"
      />
      
      <DemoBox 
        demoPath="axios/encapsulation-api"
        title="Demo 2: API æ¨¡å—åŒ–"
        description="æŒ‰ä¸šåŠ¡æ¨¡å—ç»„ç»‡ API å‡½æ•°"
        height="400px"
      />
    </KnowledgeCard>

    <!-- è¿›é˜¶å°è£… -->
    <KnowledgeCard title="âš¡ è¿›é˜¶å°è£…">
      <DemoBox 
        demoPath="axios/encapsulation-error"
        title="Demo 3: ç»Ÿä¸€é”™è¯¯å¤„ç†"
        description="å…¨å±€é”™è¯¯æç¤ºã€ä¸šåŠ¡é”™è¯¯ç å¤„ç†"
        height="400px"
      />
      
      <DemoBox 
        demoPath="axios/encapsulation-env"
        title="Demo 4: å¤šç¯å¢ƒé…ç½®"
        description="å¼€å‘/æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒçš„ baseURL åˆ‡æ¢"
        height="380px"
      />
    </KnowledgeCard>

    <!-- å®Œæ•´å°è£… -->
    <KnowledgeCard title="ğŸ¨ å®Œæ•´å°è£…æ¨¡æ¿">
      <DemoBox 
        demoPath="axios/encapsulation-full"
        title="Demo 5: ç”Ÿäº§çº§å®Œæ•´å°è£…"
        description="åŒ…å« Tokenã€Loadingã€é”™è¯¯å¤„ç†ã€è¯·æ±‚å–æ¶ˆç­‰åŠŸèƒ½"
        height="500px"
      />
    </KnowledgeCard>

    <!-- æœ€ä½³å®è·µ -->
    <TipBox type="success" title="âœ… å°è£…æœ€ä½³å®è·µ">
      <ul>
        <li><strong>å•ä¸€èŒè´£</strong>ï¼šrequest.js åªè´Ÿè´£è¯·æ±‚é…ç½®ï¼ŒAPI æ¨¡å—åªè´Ÿè´£å®šä¹‰æ¥å£</li>
        <li><strong>ç»Ÿä¸€å¯¼å‡º</strong>ï¼šé€šè¿‡ api/index.js ç»Ÿä¸€å¯¼å‡ºæ‰€æœ‰ API</li>
        <li><strong>ç¯å¢ƒéš”ç¦»</strong>ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†ä¸åŒç¯å¢ƒçš„é…ç½®</li>
        <li><strong>ç±»å‹æ³¨é‡Š</strong>ï¼šä½¿ç”¨ JSDoc æ³¨é‡Šå‚æ•°å’Œè¿”å›å€¼ç±»å‹</li>
        <li><strong>é”™è¯¯åˆ†ç±»</strong>ï¼šåŒºåˆ†ç½‘ç»œé”™è¯¯ã€ä¸šåŠ¡é”™è¯¯ã€æƒé™é”™è¯¯</li>
      </ul>
    </TipBox>

    <!-- æ³¨æ„äº‹é¡¹ -->
    <TipBox type="warning" title="âš ï¸ æ³¨æ„äº‹é¡¹">
      <ul>
        <li>ä¸è¦åœ¨ request.js ä¸­å¤„ç†å…·ä½“ä¸šåŠ¡é€»è¾‘</li>
        <li>é¿å…åœ¨æ‹¦æˆªå™¨ä¸­åšå¤ªå¤šäº‹æƒ…ï¼Œä¿æŒèŒè´£å•ä¸€</li>
        <li>Token åˆ·æ–°é€»è¾‘è¦å¤„ç†å¥½å¹¶å‘è¯·æ±‚çš„æƒ…å†µ</li>
        <li>ç”Ÿäº§ç¯å¢ƒè¦å…³é—­ console.log è¾“å‡º</li>
      </ul>
    </TipBox>
  </div>
</template>

<script>
/**
 * Encapsulation.vue
 * Axios å°è£…å®è·µè¯¦è§£é¡µé¢
 */
import KnowledgeCard from '@/components/content/KnowledgeCard.vue'
import TipBox from '@/components/content/TipBox.vue'
import CodeBlock from '@/components/demo/CodeBlock.vue'
import DemoBox from '@/components/demo/DemoBox.vue'
import scrollTrackingMixin from '@/utils/scrollTrackingMixin'

export default {
  name: 'AxiosEncapsulation',
  
  mixins: [scrollTrackingMixin],
  
  components: {
    KnowledgeCard,
    TipBox,
    CodeBlock,
    DemoBox
  },
  
  data() {
    return {
      // request.js å°è£…ä»£ç 
      requestCode: `// utils/request.js
import axios from 'axios'

// åˆ›å»º axios å®ä¾‹
const request = axios.create({
  baseURL: process.env.VUE_APP_API_URL,
  timeout: 10000
})

// è¯·æ±‚æ‹¦æˆªå™¨
request.interceptors.request.use(
  config => {
    // æ·»åŠ  Token
    const token = localStorage.getItem('token')
    if (token) {
      config.headers.Authorization = \`Bearer \${token}\`
    }
    return config
  },
  error => Promise.reject(error)
)

// å“åº”æ‹¦æˆªå™¨
request.interceptors.response.use(
  response => response.data,
  error => {
    // ç»Ÿä¸€é”™è¯¯å¤„ç†
    const message = error.response?.data?.message || 'è¯·æ±‚å¤±è´¥'
    console.error(message)
    return Promise.reject(error)
  }
)

export default request`,

      // ç”¨æˆ· API æ¨¡å—ä»£ç 
      userApiCode: `// api/user.js
import request from '@/utils/request'

/**
 * ç”¨æˆ·ç™»å½•
 * @param {Object} data - ç™»å½•ä¿¡æ¯
 * @param {string} data.username - ç”¨æˆ·å
 * @param {string} data.password - å¯†ç 
 * @returns {Promise}
 */
export function login(data) {
  return request({
    url: '/user/login',
    method: 'post',
    data
  })
}

/**
 * è·å–ç”¨æˆ·ä¿¡æ¯
 * @param {number} id - ç”¨æˆ· ID
 * @returns {Promise}
 */
export function getUserInfo(id) {
  return request({
    url: \`/user/\${id}\`,
    method: 'get'
  })
}

/**
 * æ›´æ–°ç”¨æˆ·ä¿¡æ¯
 * @param {Object} data - ç”¨æˆ·ä¿¡æ¯
 * @returns {Promise}
 */
export function updateUser(data) {
  return request({
    url: '/user/update',
    method: 'put',
    data
  })
}`,

      // ç»„ä»¶ä½¿ç”¨ä»£ç 
      usageCode: `// åœ¨ Vue ç»„ä»¶ä¸­ä½¿ç”¨
import { login, getUserInfo } from '@/api/user'

export default {
  methods: {
    async handleLogin() {
      try {
        const res = await login({
          username: 'admin',
          password: '123456'
        })
        // ä¿å­˜ Token
        localStorage.setItem('token', res.token)
        // è·å–ç”¨æˆ·ä¿¡æ¯
        const userInfo = await getUserInfo(res.userId)
        console.log('ç”¨æˆ·ä¿¡æ¯:', userInfo)
      } catch (err) {
        console.error('ç™»å½•å¤±è´¥:', err)
      }
    }
  }
}`
    }
  }
}
</script>

<style lang="scss" scoped>
.knowledge-page {
  max-width: 900px;
  margin: 0 auto;
  padding: 20px;
}

.page-header {
  text-align: center;
  margin-bottom: 32px;
  
  h1 {
    font-size: 28px;
    color: #1d1d1f;
    margin-bottom: 8px;
  }
  
  .subtitle {
    color: #86868b;
    font-size: 16px;
  }
}

.concept-content {
  p {
    margin-bottom: 16px;
    line-height: 1.8;
  }
  
  ul {
    margin: 16px 0;
    padding-left: 20px;
    
    li {
      margin-bottom: 12px;
      line-height: 1.6;
    }
  }
}

.highlight-box {
  background: #f0f9ff;
  border-left: 4px solid #007aff;
  padding: 16px;
  border-radius: 0 8px 8px 0;
  margin-top: 16px;
  
  h4 {
    color: #007aff;
    margin-bottom: 8px;
  }
  
  p {
    margin-bottom: 8px;
    font-size: 14px;
    
    &:last-child {
      margin-bottom: 0;
    }
  }
}

.architecture-diagram {
  margin-bottom: 20px;
}

.structure-tree {
  background: #1d1d1f;
  color: #e5e5ea;
  padding: 16px;
  border-radius: 8px;
  font-family: 'SF Mono', monospace;
  font-size: 13px;
  line-height: 1.6;
  overflow-x: auto;
}

.layer-description {
  display: flex;
  flex-direction: column;
  gap: 12px;
  
  .layer {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    background: #f5f5f7;
    border-radius: 8px;
  }
  
  .layer-name {
    font-weight: 600;
    color: #1d1d1f;
    min-width: 120px;
  }
  
  .layer-desc {
    color: #86868b;
    font-size: 14px;
  }
}

.code-section {
  h4 {
    font-size: 14px;
    color: #1d1d1f;
    margin-bottom: 12px;
    
    &.mt-lg {
      margin-top: 24px;
    }
  }
}
</style>

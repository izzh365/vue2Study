<template>
  <div class="knowledge-page">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="page-header">
      <h1>å“åº”å¤„ç†</h1>
      <p class="subtitle">ç†è§£ Axios å“åº”ç»“æ„å’Œé”™è¯¯å¤„ç†æœºåˆ¶</p>
    </div>

    <!-- æ¦‚å¿µè¯´æ˜ -->
    <KnowledgeCard title="ğŸ“– æ¦‚å¿µè¯´æ˜">
      <p>Axios è¯·æ±‚æˆåŠŸåè¿”å›ä¸€ä¸ª<strong>å“åº”å¯¹è±¡ï¼ˆresponseï¼‰</strong>ï¼ŒåŒ…å«äº†å®Œæ•´çš„å“åº”ä¿¡æ¯ï¼š</p>
      <ul>
        <li><strong>data</strong>ï¼šæœåŠ¡å™¨è¿”å›çš„æ•°æ®ï¼ˆæœ€å¸¸ç”¨ï¼‰</li>
        <li><strong>status</strong>ï¼šHTTP çŠ¶æ€ç ï¼ˆå¦‚ 200ã€404ã€500ï¼‰</li>
        <li><strong>statusText</strong>ï¼šçŠ¶æ€æ–‡æœ¬æè¿°</li>
        <li><strong>headers</strong>ï¼šå“åº”å¤´ä¿¡æ¯</li>
        <li><strong>config</strong>ï¼šè¯·æ±‚é…ç½®ä¿¡æ¯</li>
        <li><strong>request</strong>ï¼šåŸå§‹çš„ XMLHttpRequest å¯¹è±¡</li>
      </ul>
      
      <div class="analogy-box">
        <h4>ğŸ­ é€šä¿—æ¯”å–»</h4>
        <p>å‘é€ HTTP è¯·æ±‚å°±åƒå¯„å¿«é€’ï¼š</p>
        <ul>
          <li><strong>response.data</strong> = å¿«é€’é‡Œçš„ç‰©å“ï¼ˆä½ æœ€æƒ³è¦çš„ï¼‰</li>
          <li><strong>response.status</strong> = å¿«é€’çŠ¶æ€ï¼ˆç­¾æ”¶/æ‹’æ”¶/é€€å›ï¼‰</li>
          <li><strong>response.headers</strong> = å¿«é€’å•ä¿¡æ¯ï¼ˆå‘ä»¶äººã€æ—¥æœŸç­‰ï¼‰</li>
        </ul>
      </div>
    </KnowledgeCard>

    <!-- å“åº”ç»“æ„ -->
    <KnowledgeCard title="ğŸ“¦ å“åº”å¯¹è±¡ç»“æ„">
      <CodeBlock :code="responseStructure" language="javascript" />
    </KnowledgeCard>

    <!-- Demo 1: å“åº”ç»“æ„è§£æ -->
    <KnowledgeCard title="ğŸ¯ Demo 1: è§£æå“åº”ç»“æ„">
      <p>æŸ¥çœ‹å®Œæ•´çš„å“åº”å¯¹è±¡ç»“æ„ï¼š</p>
      <DemoBox 
        demoPath="axios/response-structure"
        title="å“åº”ç»“æ„è§£æ"
        height="380px"
      />
    </KnowledgeCard>

    <!-- HTTP çŠ¶æ€ç  -->
    <KnowledgeCard title="ğŸ“Š HTTP çŠ¶æ€ç ">
      <table class="info-table">
        <thead>
          <tr>
            <th>çŠ¶æ€ç èŒƒå›´</th>
            <th>ç±»åˆ«</th>
            <th>å¸¸è§ä¾‹å­</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>1xx</code></td>
            <td>ä¿¡æ¯æ€§</td>
            <td>100 Continue</td>
          </tr>
          <tr class="highlight-success">
            <td><code>2xx</code></td>
            <td>æˆåŠŸ</td>
            <td>200 OK, 201 Created, 204 No Content</td>
          </tr>
          <tr>
            <td><code>3xx</code></td>
            <td>é‡å®šå‘</td>
            <td>301 æ°¸ä¹…é‡å®šå‘, 302 ä¸´æ—¶é‡å®šå‘</td>
          </tr>
          <tr class="highlight-warning">
            <td><code>4xx</code></td>
            <td>å®¢æˆ·ç«¯é”™è¯¯</td>
            <td>400 Bad Request, 401 æœªæˆæƒ, 404 Not Found</td>
          </tr>
          <tr class="highlight-error">
            <td><code>5xx</code></td>
            <td>æœåŠ¡å™¨é”™è¯¯</td>
            <td>500 æœåŠ¡å™¨é”™è¯¯, 502 Bad Gateway, 503 æœåŠ¡ä¸å¯ç”¨</td>
          </tr>
        </tbody>
      </table>
    </KnowledgeCard>

    <!-- Demo 2: çŠ¶æ€ç å¤„ç† -->
    <KnowledgeCard title="ğŸ¯ Demo 2: çŠ¶æ€ç å¤„ç†">
      <p>æ ¹æ®ä¸åŒçš„çŠ¶æ€ç è¿›è¡Œç›¸åº”å¤„ç†ï¼š</p>
      <DemoBox 
        demoPath="axios/status-codes"
        title="çŠ¶æ€ç å¤„ç†"
        height="400px"
      />
    </KnowledgeCard>

    <!-- é”™è¯¯å¤„ç† -->
    <KnowledgeCard title="âš ï¸ é”™è¯¯å¤„ç†">
      <p>Axios è¯·æ±‚å¤±è´¥æ—¶ä¼šæŠ›å‡ºé”™è¯¯ï¼Œéœ€è¦ä½¿ç”¨ <code>try...catch</code> æˆ– <code>.catch()</code> å¤„ç†ï¼š</p>
      <CodeBlock :code="errorHandlingCode" language="javascript" />
      
      <div class="tip-box warning">
        <h4>ğŸ’¡ é”™è¯¯ç±»å‹</h4>
        <ul>
          <li><strong>ç½‘ç»œé”™è¯¯</strong>ï¼šæ— ç½‘ç»œè¿æ¥ã€DNS è§£æå¤±è´¥</li>
          <li><strong>è¶…æ—¶é”™è¯¯</strong>ï¼šè¯·æ±‚è¶…è¿‡è®¾å®šçš„ timeout</li>
          <li><strong>HTTP é”™è¯¯</strong>ï¼š4xxã€5xx çŠ¶æ€ç </li>
          <li><strong>å–æ¶ˆè¯·æ±‚</strong>ï¼šæ‰‹åŠ¨å–æ¶ˆçš„è¯·æ±‚</li>
        </ul>
      </div>
    </KnowledgeCard>

    <!-- Demo 3: é”™è¯¯æ•è· -->
    <KnowledgeCard title="ğŸ¯ Demo 3: é”™è¯¯æ•è·ä¸åˆ†ç±»">
      <p>åŒºåˆ†ä¸åŒç±»å‹çš„é”™è¯¯å¹¶è¿›è¡Œç›¸åº”å¤„ç†ï¼š</p>
      <DemoBox 
        demoPath="axios/error-handling"
        title="é”™è¯¯æ•è·æ¼”ç¤º"
        height="420px"
      />
    </KnowledgeCard>

    <!-- Demo 4: è¯·æ±‚å–æ¶ˆ -->
    <KnowledgeCard title="ğŸ¯ Demo 4: å–æ¶ˆè¯·æ±‚">
      <p>ä½¿ç”¨ <code>AbortController</code> æˆ– <code>CancelToken</code> å–æ¶ˆè¿›è¡Œä¸­çš„è¯·æ±‚ï¼š</p>
      <DemoBox 
        demoPath="axios/cancel-request"
        title="å–æ¶ˆè¯·æ±‚æ¼”ç¤º"
        height="380px"
      />
    </KnowledgeCard>

    <!-- Demo 5: ç»Ÿä¸€å“åº”å¤„ç† -->
    <KnowledgeCard title="ğŸ¯ Demo 5: ç»Ÿä¸€å“åº”å¤„ç†">
      <p>å°è£…ç»Ÿä¸€çš„å“åº”å¤„ç†å‡½æ•°ï¼Œç®€åŒ–ä¸šåŠ¡ä»£ç ï¼š</p>
      <DemoBox 
        demoPath="axios/unified-response"
        title="ç»Ÿä¸€å“åº”å¤„ç†"
        height="400px"
      />
    </KnowledgeCard>

    <!-- æœ€ä½³å®è·µ -->
    <TipBox type="success" title="âœ… æœ€ä½³å®è·µ">
      <ol>
        <li><strong>å§‹ç»ˆä½¿ç”¨ try...catch</strong>ï¼šé¿å…æœªæ•è·çš„é”™è¯¯å¯¼è‡´åº”ç”¨å´©æºƒ</li>
        <li><strong>åªå– response.data</strong>ï¼šå¯ä»¥åœ¨æ‹¦æˆªå™¨ä¸­ç»Ÿä¸€å¤„ç†</li>
        <li><strong>åŒºåˆ†é”™è¯¯ç±»å‹</strong>ï¼šç»™ç”¨æˆ·ä¸åŒçš„é”™è¯¯æç¤º</li>
        <li><strong>è®¾ç½®åˆç†çš„è¶…æ—¶</strong>ï¼šé¿å…è¯·æ±‚æ— é™ç­‰å¾…</li>
        <li><strong>å–æ¶ˆé‡å¤è¯·æ±‚</strong>ï¼šé¿å…ç«æ€æ¡ä»¶é—®é¢˜</li>
      </ol>
    </TipBox>

    <!-- å¸¸è§é”™è¯¯ -->
    <TipBox type="error" title="âŒ å¸¸è§é”™è¯¯">
      <div class="error-example">
        <p><strong>é”™è¯¯å†™æ³•ï¼šä¸å¤„ç†é”™è¯¯</strong></p>
        <CodeBlock :code="errorExample1" language="javascript" />
        <p><strong>æ­£ç¡®å†™æ³•ï¼šå§‹ç»ˆæ•è·é”™è¯¯</strong></p>
        <CodeBlock :code="correctExample1" language="javascript" />
      </div>
    </TipBox>
  </div>
</template>

<script>
import KnowledgeCard from '@/components/content/KnowledgeCard.vue'
import TipBox from '@/components/content/TipBox.vue'
import CodeBlock from '@/components/demo/CodeBlock.vue'
import DemoBox from '@/components/demo/DemoBox.vue'
import scrollTrackingMixin from '@/utils/scrollTrackingMixin'

export default {
  name: 'AxiosResponse',
  
  mixins: [scrollTrackingMixin],
  
  components: {
    KnowledgeCard,
    TipBox,
    CodeBlock,
    DemoBox
  },
  
  data() {
    return {
      // å“åº”ç»“æ„
      responseStructure: `// Axios å“åº”å¯¹è±¡ç»“æ„
const response = await axios.get('/api/users')

// response å¯¹è±¡åŒ…å«ï¼š
{
  data: {},         // ğŸ¯ æœåŠ¡å™¨è¿”å›çš„æ•°æ®ï¼ˆæœ€å¸¸ç”¨ï¼‰
  status: 200,      // HTTP çŠ¶æ€ç 
  statusText: 'OK', // çŠ¶æ€æ–‡æœ¬
  headers: {},      // å“åº”å¤´
  config: {},       // è¯·æ±‚é…ç½®
  request: {}       // XMLHttpRequest å¯¹è±¡
}

// é€šå¸¸åªéœ€è¦ data
const users = response.data`,

      // é”™è¯¯å¤„ç†ä»£ç 
      errorHandlingCode: `try {
  const response = await axios.get('/api/data')
  // å¤„ç†æˆåŠŸå“åº”
  console.log(response.data)
  
} catch (error) {
  if (error.response) {
    // æœåŠ¡å™¨è¿”å›äº†é”™è¯¯çŠ¶æ€ç ï¼ˆ4xxã€5xxï¼‰
    console.log('çŠ¶æ€ç :', error.response.status)
    console.log('é”™è¯¯æ•°æ®:', error.response.data)
    
  } else if (error.request) {
    // è¯·æ±‚å·²å‘é€ï¼Œä½†æ²¡æœ‰æ”¶åˆ°å“åº”ï¼ˆç½‘ç»œé”™è¯¯ï¼‰
    console.log('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥')
    
  } else {
    // è¯·æ±‚é…ç½®å‡ºé”™
    console.log('è¯·æ±‚é…ç½®é”™è¯¯:', error.message)
  }
}`,

      // é”™è¯¯ç¤ºä¾‹
      errorExample1: `// âŒ ä¸å¤„ç†é”™è¯¯ï¼Œå¯èƒ½å¯¼è‡´åº”ç”¨å´©æºƒ
const data = await axios.get('/api/users')
console.log(data)`,

      // æ­£ç¡®ç¤ºä¾‹
      correctExample1: `// âœ… å§‹ç»ˆä½¿ç”¨ try...catch
try {
  const { data } = await axios.get('/api/users')
  console.log(data)
} catch (err) {
  console.error('è¯·æ±‚å¤±è´¥:', err.message)
  // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
}`
    }
  }
}
</script>

<style lang="scss" scoped>
.knowledge-page {
  max-width: 900px;
  margin: 0 auto;
  padding: 20px;
}

.page-header {
  text-align: center;
  margin-bottom: 32px;
  
  h1 {
    font-size: 28px;
    color: #1d1d1f;
    margin-bottom: 8px;
  }
  
  .subtitle {
    color: #86868b;
    font-size: 16px;
  }
}

.analogy-box {
  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
  padding: 16px;
  border-radius: 8px;
  margin-top: 16px;
  
  h4 {
    margin-bottom: 8px;
    color: #92400e;
  }
  
  p, ul {
    color: #78350f;
    font-size: 14px;
  }
  
  ul {
    padding-left: 20px;
    margin-top: 8px;
  }
}

.info-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 12px;
  
  th, td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #e5e5ea;
  }
  
  th {
    background: #f5f5f7;
    font-weight: 600;
    color: #1d1d1f;
  }
  
  code {
    background: #e8e8ed;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 13px;
  }
  
  .highlight-success {
    background: #ecfdf5;
  }
  
  .highlight-warning {
    background: #fffbeb;
  }
  
  .highlight-error {
    background: #fef2f2;
  }
}

.tip-box {
  padding: 16px;
  border-radius: 8px;
  margin-top: 16px;
  
  &.warning {
    background: #fffbeb;
    border-left: 4px solid #f59e0b;
  }
  
  h4 {
    margin-bottom: 8px;
  }
  
  ul {
    padding-left: 20px;
    font-size: 14px;
  }
}

.error-example {
  p {
    font-size: 14px;
    margin: 12px 0 8px;
  }
}
</style>

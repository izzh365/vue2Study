<template>
  <div class="knowledge-page watch-page">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="page-header">
      <h1>ğŸ‘ï¸ watch ä¾¦å¬å™¨</h1>
      <p class="page-desc">ç›‘å¬æ•°æ®å˜åŒ–ï¼Œæ‰§è¡Œå¼‚æ­¥æ“ä½œæˆ–å¤æ‚é€»è¾‘</p>
    </div>

    <!-- æ¦‚å¿µè¯´æ˜ -->
    <KnowledgeCard title="ğŸ“– ä»€ä¹ˆæ˜¯ä¾¦å¬å™¨ï¼Ÿ">
      <p>
        <strong>watch</strong>ï¼ˆä¾¦å¬å™¨ï¼‰ç”¨äºè§‚å¯ŸæŸä¸ªæ•°æ®çš„å˜åŒ–ï¼Œå¹¶åœ¨å˜åŒ–æ—¶æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚
        å®ƒéå¸¸é€‚åˆå¤„ç†å¼‚æ­¥æ“ä½œã€å¤æ‚é€»è¾‘æˆ–éœ€è¦å¯¹æ¯”æ–°æ—§å€¼çš„åœºæ™¯ã€‚
      </p>
      <div class="analogy-box">
        <span class="analogy-icon">ğŸ‘®</span>
        <div>
          <strong>é€šä¿—æ¯”å–»ï¼š</strong>å°±åƒä¸€ä¸ªä¸“æ³¨çš„ä¿å®‰ï¼Œç›¯ç€ç‰¹å®šçš„é—¨å£ã€‚
          ä¸€æ—¦æœ‰äººè¿›å‡ºï¼ˆæ•°æ®å˜åŒ–ï¼‰ï¼Œç«‹å³è®°å½•å¹¶æ±‡æŠ¥ã€‚
        </div>
      </div>
    </KnowledgeCard>

    <!-- computed vs watch -->
    <KnowledgeCard title="ğŸ’¡ computed vs watch å¦‚ä½•é€‰æ‹©ï¼Ÿ">
      <div class="compare-table">
        <div class="compare-header">
          <div class="compare-col">åœºæ™¯</div>
          <div class="compare-col">computed</div>
          <div class="compare-col">watch</div>
        </div>
        <div class="compare-row">
          <div class="compare-col">è®¡ç®—æ´¾ç”Ÿæ•°æ®</div>
          <div class="compare-col highlight">âœ… ä¼˜å…ˆä½¿ç”¨</div>
          <div class="compare-col">å¯ä»¥ä½†ä¸æ¨è</div>
        </div>
        <div class="compare-row">
          <div class="compare-col">å¼‚æ­¥è¯·æ±‚</div>
          <div class="compare-col">âŒ ä¸æ”¯æŒ</div>
          <div class="compare-col highlight">âœ… é€‚åˆ</div>
        </div>
        <div class="compare-row">
          <div class="compare-col">éœ€è¦æ–°æ—§å€¼å¯¹æ¯”</div>
          <div class="compare-col">âŒ ä¸æ”¯æŒ</div>
          <div class="compare-col highlight">âœ… æ”¯æŒ</div>
        </div>
        <div class="compare-row">
          <div class="compare-col">å¼€é”€å¤§çš„æ“ä½œ</div>
          <div class="compare-col">ä¸æ¨è</div>
          <div class="compare-col highlight">âœ… é€‚åˆ</div>
        </div>
      </div>
      <TipBox type="info" title="é€‰æ‹©å£è¯€">
        <p>
          <strong>èƒ½ç”¨ computed å°±ç”¨ computed</strong>ï¼Œéœ€è¦å‰¯ä½œç”¨ï¼ˆå¦‚è¯·æ±‚ã€æ—¥å¿—ã€ä¿®æ”¹å…¶ä»–æ•°æ®ï¼‰æ—¶ç”¨ watchã€‚
        </p>
      </TipBox>
    </KnowledgeCard>

    <!-- è¯­æ³•æ ¼å¼ -->
    <KnowledgeCard title="ğŸ“ è¯­æ³•æ ¼å¼">
      <CodeBlock 
        :code="syntaxCode"
        language="javascript"
      />
    </KnowledgeCard>

    <!-- é…ç½®é€‰é¡¹ -->
    <KnowledgeCard title="âš™ï¸ watch é…ç½®é€‰é¡¹">
      <div class="option-list">
        <div class="option-item">
          <div class="option-name">immediate</div>
          <div class="option-desc">
            <code>true</code> æ—¶ï¼Œç»„ä»¶åˆ›å»ºåç«‹å³æ‰§è¡Œä¸€æ¬¡å›è°ƒ
          </div>
        </div>
        <div class="option-item">
          <div class="option-name">deep</div>
          <div class="option-desc">
            <code>true</code> æ—¶ï¼Œæ·±åº¦ç›‘å¬å¯¹è±¡å†…éƒ¨å±æ€§çš„å˜åŒ–
          </div>
        </div>
        <div class="option-item">
          <div class="option-name">handler</div>
          <div class="option-desc">
            ä½¿ç”¨å¯¹è±¡è¯­æ³•æ—¶ï¼Œå›è°ƒå‡½æ•°å†™åœ¨ handler ä¸­
          </div>
        </div>
      </div>
    </KnowledgeCard>

    <!-- Demo å±•ç¤ºåŒº -->
    <KnowledgeCard title="ğŸ¯ å®æˆ˜ç¤ºä¾‹">
      <!-- Demo 1: åŸºç¡€ç”¨æ³• -->
      <div class="demo-section">
        <h4>Demo 1: watch åŸºç¡€ç”¨æ³•</h4>
        <p class="demo-desc">ç›‘å¬è¾“å…¥å˜åŒ–ï¼Œè®°å½•æ—¥å¿—</p>
        <DemoBox 
          demoPath="computed-watch/watch-basic"
          title="watch åŸºæœ¬ç”¨æ³•"
          height="580px"
        />
      </div>

      <!-- Demo 2: æ–°æ—§å€¼å¯¹æ¯” -->
      <div class="demo-section">
        <h4>Demo 2: æ–°æ—§å€¼å¯¹æ¯”</h4>
        <p class="demo-desc">è®¡ç®—åˆ†æ•°å˜åŒ–é‡ï¼Œæ˜¾ç¤ºæ¶¨è·Œè¶‹åŠ¿</p>
        <DemoBox 
          demoPath="computed-watch/watch-newold"
          title="watch æ–°æ—§å€¼"
          height="650px"
        />
      </div>

      <!-- Demo 3: immediate ç«‹å³æ‰§è¡Œ -->
      <div class="demo-section">
        <h4>Demo 3: immediate ç«‹å³æ‰§è¡Œ</h4>
        <p class="demo-desc">ç»„ä»¶åˆ›å»ºæ—¶ç«‹å³æ‰§è¡Œä¸€æ¬¡å›è°ƒ</p>
        <DemoBox 
          demoPath="computed-watch/watch-immediate"
          title="watch immediate"
          height="700px"
        />
      </div>

      <!-- Demo 4: deep æ·±åº¦ç›‘å¬ -->
      <div class="demo-section">
        <h4>Demo 4: deep æ·±åº¦ç›‘å¬</h4>
        <p class="demo-desc">ç›‘å¬åµŒå¥—å¯¹è±¡å†…éƒ¨å±æ€§çš„å˜åŒ–</p>
        <DemoBox 
          demoPath="computed-watch/watch-deep"
          title="watch deep"
          height="850px"
        />
      </div>

      <!-- Demo 5: å¼‚æ­¥è¯·æ±‚ -->
      <div class="demo-section">
        <h4>Demo 5: å¼‚æ­¥è¯·æ±‚</h4>
        <p class="demo-desc">æœç´¢æ¡†é˜²æŠ– + API è¯·æ±‚</p>
        <DemoBox 
          demoPath="computed-watch/watch-async"
          title="watch å¼‚æ­¥è¯·æ±‚"
          height="650px"
        />
      </div>

      <!-- Demo 6: åŠ¨æ€ç›‘å¬ä¸å–æ¶ˆ -->
      <div class="demo-section">
        <h4>Demo 6: $watch åŠ¨æ€ç›‘å¬</h4>
        <p class="demo-desc">è¿è¡Œæ—¶åˆ›å»º/å–æ¶ˆä¾¦å¬å™¨</p>
        <DemoBox 
          demoPath="computed-watch/watch-unwatch"
          title="$watch åŠ¨æ€ç›‘å¬"
          height="700px"
        />
      </div>
    </KnowledgeCard>

    <!-- æœ€ä½³å®è·µ -->
    <KnowledgeCard title="âœ¨ æœ€ä½³å®è·µ">
      <div class="practice-list">
        <div class="practice-item good">
          <span class="practice-icon">âœ…</span>
          <div>
            <strong>ä½¿ç”¨ immediate: true å‡å°‘é‡å¤ä»£ç </strong>
            <p>ä¸éœ€è¦åœ¨ created ä¸­æ‰‹åŠ¨è°ƒç”¨ä¸€æ¬¡</p>
          </div>
        </div>
        <div class="practice-item good">
          <span class="practice-icon">âœ…</span>
          <div>
            <strong>ç›‘å¬å…·ä½“è·¯å¾„è€Œéæ•´ä¸ªå¯¹è±¡</strong>
            <p>å¦‚ <code>'user.profile.name'</code>ï¼Œæ€§èƒ½æ›´å¥½ä¸”èƒ½è·å–å‡†ç¡®æ–°æ—§å€¼</p>
          </div>
        </div>
        <div class="practice-item good">
          <span class="practice-icon">âœ…</span>
          <div>
            <strong>å¼‚æ­¥æ“ä½œé…åˆé˜²æŠ–</strong>
            <p>é¿å…é¢‘ç¹è§¦å‘ API è¯·æ±‚ï¼Œæå‡æ€§èƒ½å’Œä½“éªŒ</p>
          </div>
        </div>
        <div class="practice-item bad">
          <span class="practice-icon">âŒ</span>
          <div>
            <strong>ä¸è¦åœ¨ watch ä¸­æ— é™ä¿®æ”¹è¢«ç›‘å¬çš„æ•°æ®</strong>
            <p>ä¼šå¯¼è‡´æ­»å¾ªç¯</p>
          </div>
        </div>
      </div>
    </KnowledgeCard>

    <!-- æ³¨æ„äº‹é¡¹ -->
    <TipBox type="warning" title="âš ï¸ æ³¨æ„äº‹é¡¹">
      <ul class="warning-list">
        <li>
          <strong>æ·±åº¦ç›‘å¬å¯¹è±¡æ—¶ï¼Œæ–°æ—§å€¼æ˜¯åŒä¸€å¼•ç”¨</strong>
          <p>å› ä¸ºå¯¹è±¡æ˜¯åŸåœ°ä¿®æ”¹çš„ï¼Œå¦‚éœ€å¯¹æ¯”è¯·æå‰æ·±æ‹·è´</p>
        </li>
        <li>
          <strong>ç»„ä»¶é”€æ¯æ—¶ $watch éœ€è¦æ‰‹åŠ¨å–æ¶ˆ</strong>
          <p>åœ¨ beforeDestroy ä¸­è°ƒç”¨è¿”å›çš„å–æ¶ˆå‡½æ•°</p>
        </li>
        <li>
          <strong>é¿å…è¿‡åº¦ä½¿ç”¨ deep: true</strong>
          <p>å¤§å¯¹è±¡æ·±åº¦ç›‘å¬æœ‰æ€§èƒ½å¼€é”€ï¼Œä¼˜å…ˆç›‘å¬å…·ä½“è·¯å¾„</p>
        </li>
      </ul>
    </TipBox>
  </div>
</template>

<script>
/**
 * Watch ä¾¦å¬å™¨é¡µé¢
 * 
 * @description è¯¦ç»†è®²è§£ Vue watch ä¾¦å¬å™¨çš„ç”¨æ³•å’Œé…ç½®é€‰é¡¹
 */
import KnowledgeCard from '@/components/content/KnowledgeCard.vue'
import TipBox from '@/components/content/TipBox.vue'
import CodeBlock from '@/components/demo/CodeBlock.vue'
import DemoBox from '@/components/demo/DemoBox.vue'

export default {
  name: 'WatchPage',
  
  components: {
    KnowledgeCard,
    TipBox,
    CodeBlock,
    DemoBox
  },
  
  data() {
    return {
      // è¯­æ³•ç¤ºä¾‹ä»£ç 
      syntaxCode: `export default {
  data() {
    return {
      keyword: '',
      userInfo: { name: 'å¼ ä¸‰', age: 25 }
    }
  },
  
  watch: {
    // å†™æ³•ä¸€ï¼šå‡½æ•°å¼ï¼ˆç®€å†™ï¼‰
    keyword(newVal, oldVal) {
      console.log('ä»', oldVal, 'å˜ä¸º', newVal)
      this.search(newVal)
    },
    
    // å†™æ³•äºŒï¼šå¯¹è±¡å¼ï¼ˆå®Œæ•´é…ç½®ï¼‰
    userInfo: {
      handler(newVal, oldVal) {
        console.log('ç”¨æˆ·ä¿¡æ¯å˜åŒ–:', newVal)
      },
      immediate: true,  // ç«‹å³æ‰§è¡Œä¸€æ¬¡
      deep: true        // æ·±åº¦ç›‘å¬
    },
    
    // å†™æ³•ä¸‰ï¼šç›‘å¬åµŒå¥—è·¯å¾„
    'userInfo.name'(newName) {
      console.log('ç”¨æˆ·åå˜ä¸º:', newName)
    }
  }
}`
    }
  }
}
</script>

<style lang="scss" scoped>
.watch-page {
  .page-header {
    margin-bottom: $spacing-xl;
    
    h1 {
      font-size: $font-size-3xl;
      color: $color-text;
      margin-bottom: $spacing-sm;
    }
    
    .page-desc {
      font-size: $font-size-lg;
      color: $color-text-secondary;
    }
  }
  
  .analogy-box {
    display: flex;
    align-items: flex-start;
    gap: $spacing-md;
    padding: $spacing-md;
    background: linear-gradient(135deg, #fff3e0 0%, #fce4ec 100%);
    border-radius: $radius-md;
    margin-top: $spacing-md;
    
    .analogy-icon {
      font-size: 28px;
    }
  }
  
  // å¯¹æ¯”è¡¨æ ¼
  .compare-table {
    border: 1px solid $color-border;
    border-radius: $radius-md;
    overflow: hidden;
    
    .compare-header,
    .compare-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      
      .compare-col {
        padding: $spacing-md;
        border-right: 1px solid $color-border;
        
        &:last-child {
          border-right: none;
        }
        
        &.highlight {
          background: #e8f5e9;
        }
      }
    }
    
    .compare-header {
      background: $color-code-bg;
      font-weight: 600;
    }
    
    .compare-row {
      border-top: 1px solid $color-border;
    }
  }
  
  // é…ç½®é€‰é¡¹åˆ—è¡¨
  .option-list {
    display: flex;
    flex-direction: column;
    gap: $spacing-md;
    
    .option-item {
      display: flex;
      align-items: flex-start;
      gap: $spacing-lg;
      padding: $spacing-md;
      background: $color-code-bg;
      border-radius: $radius-md;
      
      .option-name {
        font-family: $font-family-code;
        font-weight: 600;
        color: $color-primary;
        min-width: 100px;
      }
      
      .option-desc {
        flex: 1;
        color: $color-text-secondary;
        
        code {
          background: rgba($color-primary, 0.1);
          padding: 2px 6px;
          border-radius: 4px;
          color: $color-primary;
        }
      }
    }
  }
  
  .demo-section {
    margin-bottom: $spacing-xl;
    
    &:last-child {
      margin-bottom: 0;
    }
    
    h4 {
      font-size: $font-size-lg;
      color: $color-text;
      margin-bottom: $spacing-sm;
    }
    
    .demo-desc {
      color: $color-text-secondary;
      margin-bottom: $spacing-md;
    }
  }
  
  // æœ€ä½³å®è·µåˆ—è¡¨
  .practice-list {
    display: flex;
    flex-direction: column;
    gap: $spacing-md;
    
    .practice-item {
      display: flex;
      align-items: flex-start;
      gap: $spacing-md;
      padding: $spacing-md;
      border-radius: $radius-md;
      
      &.good {
        background: #e8f5e9;
      }
      
      &.bad {
        background: #ffebee;
      }
      
      .practice-icon {
        font-size: 20px;
        flex-shrink: 0;
      }
      
      strong {
        display: block;
        margin-bottom: 4px;
        color: $color-text;
      }
      
      p {
        font-size: $font-size-sm;
        color: $color-text-secondary;
        margin: 0;
      }
      
      code {
        background: rgba(0, 0, 0, 0.05);
        padding: 2px 6px;
        border-radius: 4px;
      }
    }
  }
  
  // è­¦å‘Šåˆ—è¡¨
  .warning-list {
    margin: 0;
    padding-left: $spacing-lg;
    
    li {
      margin-bottom: $spacing-md;
      
      &:last-child {
        margin-bottom: 0;
      }
      
      strong {
        display: block;
        color: $color-text;
      }
      
      p {
        margin: 4px 0 0;
        font-size: $font-size-sm;
        color: $color-text-secondary;
      }
    }
  }
}
</style>

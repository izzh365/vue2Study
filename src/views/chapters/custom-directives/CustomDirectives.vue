<template>
  <div class="custom-directives-page">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="page-header">
      <h1>ğŸ”§ è‡ªå®šä¹‰æŒ‡ä»¤</h1>
      <p class="subtitle">Custom Directives - æ‰©å±• Vue çš„èƒ½åŠ›</p>
    </div>

    <!-- æ¦‚å¿µè¯´æ˜ -->
    <KnowledgeCard title="ğŸ“– ä»€ä¹ˆæ˜¯è‡ªå®šä¹‰æŒ‡ä»¤ï¼Ÿ">
      <div class="concept-content">
        <div class="analogy">
          <span class="emoji">ğŸ </span>
          <div>
            <strong>é€šä¿—æ¯”å–»ï¼š</strong>
            æƒ³è±¡ä½ åœ¨è£…ä¿®æˆ¿å­ï¼ŒVue å†…ç½®æŒ‡ä»¤ï¼ˆv-ifã€v-forï¼‰å°±åƒæ ‡å‡†å®¶å…·ï¼Œ
            è€Œ<strong>è‡ªå®šä¹‰æŒ‡ä»¤</strong>å°±åƒä½ è¯·æœ¨å·¥å®šåˆ¶çš„å®¶å…·â€”â€”å¯ä»¥å®Œå…¨æŒ‰ç…§ä½ çš„éœ€æ±‚æ¥ï¼
          </div>
        </div>
        <p class="definition">
          <strong>å®˜æ–¹å®šä¹‰ï¼š</strong>
          è‡ªå®šä¹‰æŒ‡ä»¤æ˜¯ Vue æä¾›çš„ä¸€ç§åº•å±‚ DOM æ“ä½œçš„æ–¹å¼ã€‚
          å½“ä½ éœ€è¦å¯¹æ™®é€š DOM å…ƒç´ è¿›è¡Œç›´æ¥æ“ä½œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰æŒ‡ä»¤ã€‚
        </p>
      </div>
    </KnowledgeCard>

    <!-- ä¸ºä»€ä¹ˆéœ€è¦ -->
    <KnowledgeCard title="ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰æŒ‡ä»¤ï¼Ÿ">
      <ul class="reason-list">
        <li>
          <span class="icon">ğŸ¯</span>
          <div>
            <strong>å¤ç”¨ DOM æ“ä½œé€»è¾‘</strong>
            <p>å°†å¸¸ç”¨çš„ DOM æ“ä½œå°è£…æˆæŒ‡ä»¤ï¼Œå¤šå¤„å¤ç”¨</p>
          </div>
        </li>
        <li>
          <span class="icon">ğŸ”Œ</span>
          <div>
            <strong>ä¸ç¬¬ä¸‰æ–¹åº“é›†æˆ</strong>
            <p>å¦‚åˆå§‹åŒ– jQuery æ’ä»¶ã€ECharts å›¾è¡¨ç­‰</p>
          </div>
        </li>
        <li>
          <span class="icon">âš¡</span>
          <div>
            <strong>æ€§èƒ½ä¼˜åŒ–</strong>
            <p>ç›´æ¥æ“ä½œ DOM é¿å…ä¸å¿…è¦çš„ç»„ä»¶æ¸²æŸ“</p>
          </div>
        </li>
      </ul>
    </KnowledgeCard>

    <!-- é’©å­å‡½æ•° -->
    <KnowledgeCard title="ğŸª æŒ‡ä»¤é’©å­å‡½æ•°">
      <div class="hooks-table">
        <table>
          <thead>
            <tr>
              <th>é’©å­å‡½æ•°</th>
              <th>è°ƒç”¨æ—¶æœº</th>
              <th>å¸¸è§ç”¨é€”</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>bind</code></td>
              <td>æŒ‡ä»¤ç¬¬ä¸€æ¬¡ç»‘å®šåˆ°å…ƒç´ æ—¶</td>
              <td>åˆå§‹åŒ–è®¾ç½®ã€ç»‘å®šäº‹ä»¶</td>
            </tr>
            <tr>
              <td><code>inserted</code></td>
              <td>å…ƒç´ æ’å…¥çˆ¶èŠ‚ç‚¹æ—¶</td>
              <td>éœ€è¦çˆ¶èŠ‚ç‚¹çš„æ“ä½œã€è‡ªåŠ¨èšç„¦</td>
            </tr>
            <tr>
              <td><code>update</code></td>
              <td>VNode æ›´æ–°æ—¶</td>
              <td>æ ¹æ®æ–°å€¼æ›´æ–° DOM</td>
            </tr>
            <tr>
              <td><code>componentUpdated</code></td>
              <td>VNode åŠå­ VNode å…¨éƒ¨æ›´æ–°å</td>
              <td>éœ€è¦ç­‰å­ç»„ä»¶æ›´æ–°å®Œæˆçš„æ“ä½œ</td>
            </tr>
            <tr>
              <td><code>unbind</code></td>
              <td>æŒ‡ä»¤ä¸å…ƒç´ è§£ç»‘æ—¶</td>
              <td>æ¸…ç†å·¥ä½œï¼šç§»é™¤äº‹ä»¶ã€å®šæ—¶å™¨</td>
            </tr>
          </tbody>
        </table>
      </div>
    </KnowledgeCard>

    <!-- é’©å­å‚æ•° -->
    <KnowledgeCard title="ğŸ“ é’©å­å‡½æ•°å‚æ•°">
      <div class="code-example">
        <CodeBlock :code="hookParamsCode" language="javascript" />
      </div>
      <div class="params-table">
        <table>
          <thead>
            <tr>
              <th>å‚æ•°</th>
              <th>ç±»å‹</th>
              <th>è¯´æ˜</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>el</code></td>
              <td>HTMLElement</td>
              <td>æŒ‡ä»¤ç»‘å®šçš„ DOM å…ƒç´ </td>
            </tr>
            <tr>
              <td><code>binding.value</code></td>
              <td>any</td>
              <td>æŒ‡ä»¤ç»‘å®šçš„å€¼</td>
            </tr>
            <tr>
              <td><code>binding.arg</code></td>
              <td>string</td>
              <td>æŒ‡ä»¤å‚æ•°ï¼Œå¦‚ v-dir:arg ä¸­çš„ arg</td>
            </tr>
            <tr>
              <td><code>binding.modifiers</code></td>
              <td>object</td>
              <td>ä¿®é¥°ç¬¦å¯¹è±¡ï¼Œå¦‚ { foo: true }</td>
            </tr>
            <tr>
              <td><code>vnode</code></td>
              <td>VNode</td>
              <td>Vue ç¼–è¯‘çš„è™šæ‹ŸèŠ‚ç‚¹</td>
            </tr>
          </tbody>
        </table>
      </div>
    </KnowledgeCard>

    <!-- Demo åˆ—è¡¨ -->
    <KnowledgeCard title="ğŸ¯ å®æˆ˜ç¤ºä¾‹">
      <div class="demo-grid">
        <!-- Demo 1: v-focus -->
        <div class="demo-card">
          <div class="demo-icon">ğŸ¯</div>
          <h4>v-focus è‡ªåŠ¨èšç„¦</h4>
          <p>å…ƒç´ æŒ‚è½½åè‡ªåŠ¨è·å–ç„¦ç‚¹</p>
          <DemoBox
            demoPath="custom-directives/v-focus"
            title="v-focus è‡ªåŠ¨èšç„¦æŒ‡ä»¤"
            height="350px"
          />
        </div>

        <!-- Demo 2: v-color -->
        <div class="demo-card">
          <div class="demo-icon">ğŸ¨</div>
          <h4>v-color æ–‡å­—é¢œè‰²</h4>
          <p>åŠ¨æ€è®¾ç½®å…ƒç´ é¢œè‰²</p>
          <DemoBox
            demoPath="custom-directives/v-color"
            title="v-color é¢œè‰²æŒ‡ä»¤"
            height="400px"
          />
        </div>

        <!-- Demo 3: v-copy -->
        <div class="demo-card">
          <div class="demo-icon">ğŸ“‹</div>
          <h4>v-copy ä¸€é”®å¤åˆ¶</h4>
          <p>ç‚¹å‡»å¤åˆ¶æ–‡æœ¬åˆ°å‰ªè´´æ¿</p>
          <DemoBox
            demoPath="custom-directives/v-copy"
            title="v-copy å¤åˆ¶æŒ‡ä»¤"
            height="500px"
          />
        </div>

        <!-- Demo 4: v-loading -->
        <div class="demo-card">
          <div class="demo-icon">â³</div>
          <h4>v-loading åŠ è½½çŠ¶æ€</h4>
          <p>æ˜¾ç¤ºåŠ è½½é®ç½©å±‚</p>
          <DemoBox
            demoPath="custom-directives/v-loading"
            title="v-loading åŠ è½½æŒ‡ä»¤"
            height="550px"
          />
        </div>

        <!-- Demo 5: v-lazy -->
        <div class="demo-card">
          <div class="demo-icon">ğŸ–¼ï¸</div>
          <h4>v-lazy å›¾ç‰‡æ‡’åŠ è½½</h4>
          <p>è¿›å…¥å¯è§†åŒºå†åŠ è½½å›¾ç‰‡</p>
          <DemoBox
            demoPath="custom-directives/v-lazy"
            title="v-lazy æ‡’åŠ è½½æŒ‡ä»¤"
            height="550px"
          />
        </div>

        <!-- Demo 6: v-permission -->
        <div class="demo-card">
          <div class="demo-icon">ğŸ”</div>
          <h4>v-permission æƒé™æ§åˆ¶</h4>
          <p>æ ¹æ®æƒé™æ˜¾ç¤º/éšè—å…ƒç´ </p>
          <DemoBox
            demoPath="custom-directives/v-permission"
            title="v-permission æƒé™æŒ‡ä»¤"
            height="600px"
          />
        </div>

        <!-- Demo 7: v-click-outside -->
        <div class="demo-card">
          <div class="demo-icon">ğŸ–±ï¸</div>
          <h4>v-click-outside ç‚¹å‡»å¤–éƒ¨</h4>
          <p>æ£€æµ‹ç‚¹å‡»å…ƒç´ å¤–éƒ¨</p>
          <DemoBox
            demoPath="custom-directives/v-click-outside"
            title="v-click-outside æŒ‡ä»¤"
            height="550px"
          />
        </div>

        <!-- Demo 8: directive-args -->
        <div class="demo-card">
          <div class="demo-icon">ğŸ“</div>
          <h4>å‚æ•°ä¸ä¿®é¥°ç¬¦</h4>
          <p>æŒ‡ä»¤çš„å®Œæ•´è¯­æ³•ç»“æ„</p>
          <DemoBox
            demoPath="custom-directives/directive-args"
            title="æŒ‡ä»¤å‚æ•°ä¸ä¿®é¥°ç¬¦"
            height="750px"
          />
        </div>
      </div>
    </KnowledgeCard>

    <!-- æ³¨å†Œæ–¹å¼ -->
    <KnowledgeCard title="ğŸ“‹ æŒ‡ä»¤æ³¨å†Œæ–¹å¼">
      <div class="register-types">
        <div class="register-item">
          <h4>ğŸŒ å…¨å±€æ³¨å†Œ</h4>
          <CodeBlock :code="globalRegisterCode" language="javascript" />
          <p class="tip">åœ¨ main.js ä¸­æ³¨å†Œï¼Œæ‰€æœ‰ç»„ä»¶å¯ç”¨</p>
        </div>
        <div class="register-item">
          <h4>ğŸ“¦ å±€éƒ¨æ³¨å†Œ</h4>
          <CodeBlock :code="localRegisterCode" language="javascript" />
          <p class="tip">åªåœ¨å½“å‰ç»„ä»¶å†…å¯ç”¨</p>
        </div>
      </div>
    </KnowledgeCard>

    <!-- æ³¨æ„äº‹é¡¹ -->
    <TipBox type="warning" title="âš ï¸ æ³¨æ„äº‹é¡¹">
      <ul>
        <li><strong>unbind æ¸…ç†ï¼š</strong>åœ¨ unbind ä¸­ç§»é™¤äº‹ä»¶ç›‘å¬ã€å®šæ—¶å™¨ç­‰ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</li>
        <li><strong>é¿å…æ“ä½œå“åº”å¼æ•°æ®ï¼š</strong>æŒ‡ä»¤ä¸»è¦ç”¨äº DOM æ“ä½œï¼Œå¤æ‚é€»è¾‘å»ºè®®ç”¨ç»„ä»¶</li>
        <li><strong>el å¯èƒ½æœªæ¸²æŸ“ï¼š</strong>åœ¨ bind ä¸­ el å·²æ’å…¥æ–‡æ¡£ï¼Œä½†çˆ¶å…ƒç´ å¯èƒ½è¿˜ä¸å­˜åœ¨</li>
        <li><strong>vnode.contextï¼š</strong>å¯é€šè¿‡å®ƒè®¿é—® Vue å®ä¾‹ï¼Œä½†è¦è°¨æ…ä½¿ç”¨</li>
      </ul>
    </TipBox>

    <!-- æœ€ä½³å®è·µ -->
    <TipBox type="success" title="âœ… æœ€ä½³å®è·µ">
      <ul>
        <li><strong>ç®€å• DOM æ“ä½œï¼š</strong>åªåšç®€å• DOM æ“ä½œï¼Œå¤æ‚é€»è¾‘ç”¨ç»„ä»¶</li>
        <li><strong>å‡½æ•°ç®€å†™ï¼š</strong>åªéœ€ bind å’Œ update æ—¶ï¼Œå¯ç”¨å‡½æ•°ç®€å†™</li>
        <li><strong>å‘½åè§„èŒƒï¼š</strong>ä½¿ç”¨ kebab-caseï¼ˆå¦‚ v-my-directiveï¼‰</li>
        <li><strong>åŠæ—¶æ¸…ç†ï¼š</strong>unbind ä¸­æ¸…ç†æ‰€æœ‰å‰¯ä½œç”¨</li>
      </ul>
    </TipBox>
  </div>
</template>

<script>
/**
 * @description ç¬¬å…­ç« ï¼šè‡ªå®šä¹‰æŒ‡ä»¤å­¦ä¹ é¡µé¢
 * @author Vue2 Learning Project
 */
import KnowledgeCard from '@/components/content/KnowledgeCard.vue'
import TipBox from '@/components/content/TipBox.vue'
import DemoBox from '@/components/demo/DemoBox.vue'
import CodeBlock from '@/components/demo/CodeBlock.vue'

export default {
  name: 'CustomDirectives',

  components: {
    KnowledgeCard,
    TipBox,
    DemoBox,
    CodeBlock
  },

  data() {
    return {
      // é’©å­å‚æ•°ç¤ºä¾‹ä»£ç 
      hookParamsCode: `Vue.directive('my-directive', {
  bind(el, binding, vnode) {
    // el: ç»‘å®šçš„ DOM å…ƒç´ 
    // binding: åŒ…å«æŒ‡ä»¤ä¿¡æ¯çš„å¯¹è±¡
    //   - value: ç»‘å®šå€¼
    //   - arg: å‚æ•°
    //   - modifiers: ä¿®é¥°ç¬¦å¯¹è±¡
    // vnode: Vue ç¼–è¯‘çš„è™šæ‹ŸèŠ‚ç‚¹
    
    console.log('å‚æ•°:', binding.arg)         // v-dir:foo ä¸­çš„ "foo"
    console.log('å€¼:', binding.value)         // v-dir="123" ä¸­çš„ 123
    console.log('ä¿®é¥°ç¬¦:', binding.modifiers) // v-dir.a.b ä¸­çš„ { a: true, b: true }
  }
})`,

      // å…¨å±€æ³¨å†Œç¤ºä¾‹
      globalRegisterCode: `// main.js
import Vue from 'vue'

// å…¨å±€æ³¨å†Œè‡ªå®šä¹‰æŒ‡ä»¤
Vue.directive('focus', {
  inserted(el) {
    el.focus()
  }
})`,

      // å±€éƒ¨æ³¨å†Œç¤ºä¾‹
      localRegisterCode: `// MyComponent.vue
export default {
  directives: {
    focus: {
      inserted(el) {
        el.focus()
      }
    }
  }
}`
    }
  }
}
</script>

<style lang="scss" scoped>
.custom-directives-page {
  padding: $spacing-lg;
  max-width: 1200px;
  margin: 0 auto;
}

.page-header {
  text-align: center;
  margin-bottom: $spacing-xl;

  h1 {
    font-size: 2.5rem;
    color: $color-text;
    margin-bottom: $spacing-sm;
  }

  .subtitle {
    color: $color-text-secondary;
    font-size: $font-size-lg;
  }
}

.concept-content {
  .analogy {
    display: flex;
    gap: $spacing-md;
    padding: $spacing-md;
    background: linear-gradient(135deg, #fff5f5 0%, #fff0f5 100%);
    border-radius: $radius-md;
    margin-bottom: $spacing-md;

    .emoji {
      font-size: 2rem;
    }
  }

  .definition {
    padding: $spacing-md;
    background: $color-code-bg;
    border-radius: $radius-md;
    border-left: 4px solid $color-primary;
  }
}

.reason-list {
  list-style: none;

  li {
    display: flex;
    gap: $spacing-md;
    padding: $spacing-md;
    background: $color-code-bg;
    border-radius: $radius-md;
    margin-bottom: $spacing-sm;

    &:last-child {
      margin-bottom: 0;
    }

    .icon {
      font-size: 1.5rem;
    }

    p {
      color: $color-text-secondary;
      margin-top: $spacing-xs;
    }
  }
}

.hooks-table,
.params-table {
  overflow-x: auto;

  table {
    width: 100%;
    border-collapse: collapse;

    th, td {
      padding: $spacing-sm $spacing-md;
      text-align: left;
      border-bottom: 1px solid $color-border;
    }

    th {
      background: $color-code-bg;
      font-weight: 600;
      color: $color-text-secondary;
      font-size: $font-size-sm;
    }

    code {
      background: #e8f5e9;
      color: #2e7d32;
      padding: 2px 8px;
      border-radius: 4px;
      font-family: $font-family-code;
    }
  }
}

.demo-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: $spacing-lg;
}

.demo-card {
  background: $color-code-bg;
  border-radius: $radius-md;
  padding: $spacing-lg;

  .demo-icon {
    font-size: 2rem;
    margin-bottom: $spacing-sm;
  }

  h4 {
    color: $color-text;
    margin-bottom: $spacing-xs;
  }

  > p {
    color: $color-text-secondary;
    font-size: $font-size-sm;
    margin-bottom: $spacing-md;
  }
}

.register-types {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: $spacing-lg;

  .register-item {
    h4 {
      color: $color-primary;
      margin-bottom: $spacing-sm;
    }

    .tip {
      margin-top: $spacing-sm;
      color: $color-text-secondary;
      font-size: $font-size-sm;
    }
  }
}

.code-example {
  margin-bottom: $spacing-md;
}
</style>

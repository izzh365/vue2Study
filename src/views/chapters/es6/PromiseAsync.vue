<template>
  <div class="knowledge-page">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="page-header">
      <h1>â³ Promise ä¸å¼‚æ­¥</h1>
      <p class="subtitle">ä¼˜é›…å¤„ç†å¼‚æ­¥æ“ä½œï¼Œå‘Šåˆ«å›è°ƒåœ°ç‹±</p>
    </div>

    <!-- 1. æ¦‚å¿µè¯´æ˜ -->
    <KnowledgeCard title="ğŸ“– æ¦‚å¿µè¯´æ˜ï¼ˆæ˜¯ä»€ä¹ˆï¼‰">
      <div class="concept-content">
        <h4>ğŸ¯ é€šä¿—æ¯”å–»</h4>
        <p>Promise å°±åƒ"å¤–å–è®¢å•"ï¼š</p>
        <ul>
          <li><strong>pendingï¼ˆè¿›è¡Œä¸­ï¼‰</strong>ï¼šå¤–å–æ­£åœ¨é…é€</li>
          <li><strong>fulfilledï¼ˆæˆåŠŸï¼‰</strong>ï¼šå¤–å–é€åˆ°äº†ï¼Œå¼€åƒï¼</li>
          <li><strong>rejectedï¼ˆå¤±è´¥ï¼‰</strong>ï¼šå¤–å–æ´’äº†ï¼Œç”³è¯·é€€æ¬¾</li>
        </ul>
        <p>ä½ ä¸‹å•åä¸ç”¨ä¸€ç›´ç­‰ç€ï¼ˆå¼‚æ­¥ï¼‰ï¼Œå¤–å–åˆ°äº†ä¼šé€šçŸ¥ä½ ï¼ˆå›è°ƒï¼‰</p>
        
        <h4>ğŸ“š ä¸ºä»€ä¹ˆéœ€è¦ Promise</h4>
        <p>è§£å†³å›è°ƒåœ°ç‹±é—®é¢˜ï¼Œè®©å¼‚æ­¥ä»£ç åƒåŒæ­¥ä¸€æ ·æ¸…æ™°</p>
        
        <h4>ğŸ”¥ Promise ä¸‰ç§çŠ¶æ€</h4>
        <ul>
          <li><code>pending</code>ï¼šåˆå§‹çŠ¶æ€ï¼Œè¿›è¡Œä¸­</li>
          <li><code>fulfilled</code>ï¼šæ“ä½œæˆåŠŸå®Œæˆ</li>
          <li><code>rejected</code>ï¼šæ“ä½œå¤±è´¥</li>
        </ul>
        <p>çŠ¶æ€ä¸€æ—¦æ”¹å˜å°±ä¸å¯é€†ï¼</p>
      </div>
    </KnowledgeCard>

    <!-- 2. è¯­æ³•è¯´æ˜ -->
    <KnowledgeCard title="ğŸ“ åŸºæœ¬è¯­æ³•">
      <CodeBlock :code="syntaxCode" language="javascript" />
    </KnowledgeCard>

    <!-- Demo åˆ—è¡¨ -->
    <h2 class="section-title">ğŸ¯ å®æˆ˜æ¼”ç¤º</h2>

    <!-- Demo 1: å›è°ƒåœ°ç‹± -->
    <KnowledgeCard title="Demo 1ï¼šå›è°ƒåœ°ç‹±é—®é¢˜">
      <p class="demo-desc">åµŒå¥—çš„å›è°ƒè®©ä»£ç éš¾ä»¥é˜…è¯»å’Œç»´æŠ¤</p>
      <DemoBox 
        demoPath="es6/callback-hell"
        title="å›è°ƒåœ°ç‹±"
        :height="360"
      />
    </KnowledgeCard>

    <!-- Demo 2: Promise åŸºæœ¬ç”¨æ³• -->
    <KnowledgeCard title="Demo 2ï¼šPromise åŸºæœ¬ç”¨æ³•">
      <p class="demo-desc">åˆ›å»ºå’Œä½¿ç”¨ Promiseï¼Œç†è§£ resolve å’Œ reject</p>
      <DemoBox 
        demoPath="es6/promise-basic"
        title="Promise åŸºç¡€"
        :height="380"
      />
    </KnowledgeCard>

    <!-- Demo 3: é“¾å¼è°ƒç”¨ -->
    <KnowledgeCard title="Demo 3ï¼šé“¾å¼è°ƒç”¨">
      <p class="demo-desc">then è¿”å›æ–°çš„ Promiseï¼Œå®ç°é“¾å¼è°ƒç”¨</p>
      <DemoBox 
        demoPath="es6/promise-chain"
        title="é“¾å¼è°ƒç”¨"
        :height="400"
      />
    </KnowledgeCard>

    <!-- Demo 4: é”™è¯¯å¤„ç† -->
    <KnowledgeCard title="Demo 4ï¼šé”™è¯¯å¤„ç†">
      <p class="demo-desc">catch æ•è·é”™è¯¯ï¼Œfinally æ— è®ºæˆåŠŸå¤±è´¥éƒ½æ‰§è¡Œ</p>
      <DemoBox 
        demoPath="es6/promise-catch"
        title="é”™è¯¯å¤„ç†"
        :height="360"
      />
    </KnowledgeCard>

    <!-- Demo 5: Promise.all -->
    <KnowledgeCard title="Demo 5ï¼šPromise.all å¹¶å‘è¯·æ±‚">
      <p class="demo-desc">åŒæ—¶å‘èµ·å¤šä¸ªè¯·æ±‚ï¼Œå…¨éƒ¨æˆåŠŸæ‰æˆåŠŸ</p>
      <DemoBox 
        demoPath="es6/promise-all"
        title="Promise.all"
        :height="380"
      />
    </KnowledgeCard>

    <!-- Demo 6: Promise.race -->
    <KnowledgeCard title="Demo 6ï¼šPromise.race ç«é€Ÿ">
      <p class="demo-desc">å¤šä¸ªè¯·æ±‚ï¼Œä»¥æœ€å¿«å®Œæˆçš„ç»“æœä¸ºå‡†</p>
      <DemoBox 
        demoPath="es6/promise-race"
        title="Promise.race"
        :height="360"
      />
    </KnowledgeCard>

    <!-- Demo 7: async/await -->
    <KnowledgeCard title="Demo 7ï¼šasync/await è¯­æ³•ç³–">
      <p class="demo-desc">è®©å¼‚æ­¥ä»£ç çœ‹èµ·æ¥åƒåŒæ­¥ä»£ç </p>
      <DemoBox 
        demoPath="es6/async-await"
        title="async/await"
        :height="400"
      />
    </KnowledgeCard>

    <!-- Demo 8: Vue ä¸­åº”ç”¨ -->
    <KnowledgeCard title="Demo 8ï¼šåœ¨ Vue ä¸­çš„åº”ç”¨">
      <p class="demo-desc">åœ¨ createdã€methods ä¸­å¤„ç†å¼‚æ­¥è¯·æ±‚</p>
      <DemoBox 
        demoPath="es6/promise-vue"
        title="Vue ä¸­åº”ç”¨"
        :height="420"
      />
    </KnowledgeCard>

    <!-- API å¯¹æ¯” -->
    <KnowledgeCard title="ğŸ“Š Promise é™æ€æ–¹æ³•å¯¹æ¯”">
      <table class="compare-table">
        <thead>
          <tr>
            <th>æ–¹æ³•</th>
            <th>è¯´æ˜</th>
            <th>ä½¿ç”¨åœºæ™¯</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Promise.all()</code></td>
            <td>å…¨éƒ¨æˆåŠŸæ‰æˆåŠŸï¼Œä¸€ä¸ªå¤±è´¥å°±å¤±è´¥</td>
            <td>åŒæ—¶è¯·æ±‚å¤šä¸ª API</td>
          </tr>
          <tr>
            <td><code>Promise.race()</code></td>
            <td>è¿”å›æœ€å…ˆå®Œæˆçš„ç»“æœ</td>
            <td>è¶…æ—¶å¤„ç†ã€ç«é€Ÿ</td>
          </tr>
          <tr>
            <td><code>Promise.allSettled()</code></td>
            <td>ç­‰å¾…å…¨éƒ¨å®Œæˆï¼Œä¸ç®¡æˆåŠŸå¤±è´¥</td>
            <td>æ‰¹é‡æ“ä½œç»Ÿè®¡ç»“æœ</td>
          </tr>
          <tr>
            <td><code>Promise.any()</code></td>
            <td>ä»»æ„ä¸€ä¸ªæˆåŠŸå°±æˆåŠŸ</td>
            <td>å¤šæºæ•°æ®è·å–</td>
          </tr>
          <tr>
            <td><code>Promise.resolve()</code></td>
            <td>è¿”å›æˆåŠŸçš„ Promise</td>
            <td>å¿«é€Ÿåˆ›å»ºæˆåŠŸçŠ¶æ€</td>
          </tr>
          <tr>
            <td><code>Promise.reject()</code></td>
            <td>è¿”å›å¤±è´¥çš„ Promise</td>
            <td>å¿«é€Ÿåˆ›å»ºå¤±è´¥çŠ¶æ€</td>
          </tr>
        </tbody>
      </table>
    </KnowledgeCard>

    <!-- æ³¨æ„äº‹é¡¹ -->
    <TipBox type="info" title="ğŸ’¡ async/await ä½¿ç”¨æŠ€å·§">
      <ul>
        <li><strong>async å‡½æ•°æ€»æ˜¯è¿”å› Promise</strong></li>
        <li><strong>await åªèƒ½åœ¨ async å‡½æ•°ä¸­ä½¿ç”¨</strong></li>
        <li><strong>é”™è¯¯å¤„ç†ç”¨ try...catch</strong></li>
        <li><strong>å¹¶å‘è¯·æ±‚ç”¨ Promise.all + await</strong></li>
      </ul>
    </TipBox>

    <TipBox type="warning" title="âš ï¸ å¸¸è§é”™è¯¯">
      <ul>
        <li>å¿˜è®° return Promise å¯¼è‡´é“¾å¼è°ƒç”¨æ–­å¼€</li>
        <li>å¿˜è®°å¤„ç† reject å¯¼è‡´ Uncaught Promise rejection</li>
        <li>åœ¨å¾ªç¯ä¸­ç”¨ await å¯¼è‡´ä¸²è¡Œè¯·æ±‚ï¼ˆåº”è¯¥ç”¨ Promise.allï¼‰</li>
      </ul>
    </TipBox>
  </div>
</template>

<script>
/**
 * @description Promise ä¸å¼‚æ­¥çŸ¥è¯†ç‚¹é¡µé¢
 * @author Vue2 Learning Project
 */
import KnowledgeCard from '@/components/content/KnowledgeCard.vue'
import TipBox from '@/components/content/TipBox.vue'
import CodeBlock from '@/components/demo/CodeBlock.vue'
import DemoBox from '@/components/demo/DemoBox.vue'

export default {
  name: 'PromiseAsync',
  
  components: {
    KnowledgeCard,
    TipBox,
    CodeBlock,
    DemoBox
  },
  
  data() {
    return {
      syntaxCode: `// ==================== åˆ›å»º Promise ====================
const promise = new Promise((resolve, reject) => {
  // å¼‚æ­¥æ“ä½œ
  setTimeout(() => {
    const success = true
    
    if (success) {
      resolve('æˆåŠŸçš„æ•°æ®')   // çŠ¶æ€å˜ä¸º fulfilled
    } else {
      reject(new Error('å¤±è´¥åŸå› '))  // çŠ¶æ€å˜ä¸º rejected
    }
  }, 1000)
})


// ==================== ä½¿ç”¨ Promise ====================
promise
  .then(data => {
    console.log('æˆåŠŸ:', data)
    return 'å¤„ç†åçš„æ•°æ®'      // è¿”å›å€¼ä¼ ç»™ä¸‹ä¸€ä¸ª then
  })
  .then(data => {
    console.log('ç¬¬äºŒæ­¥:', data)
  })
  .catch(error => {
    console.log('å¤±è´¥:', error.message)
  })
  .finally(() => {
    console.log('æ— è®ºæˆåŠŸå¤±è´¥éƒ½æ‰§è¡Œ')
  })


// ==================== async/await ====================
async function fetchData() {
  try {
    const response = await fetch('/api/users')
    const data = await response.json()
    console.log('æ•°æ®:', data)
    return data
  } catch (error) {
    console.log('é”™è¯¯:', error)
  }
}

// è°ƒç”¨
fetchData().then(data => {
  console.log('æœ€ç»ˆæ•°æ®:', data)
})`
    }
  }
}
</script>

<style lang="scss" scoped>
.knowledge-page {
  max-width: 900px;
  margin: 0 auto;
}

.page-header {
  margin-bottom: $spacing-xl;
  
  h1 {
    font-size: $font-size-3xl;
    margin-bottom: $spacing-sm;
  }
  
  .subtitle {
    color: $color-text-secondary;
    font-size: $font-size-lg;
  }
}

.section-title {
  font-size: $font-size-xl;
  margin: $spacing-xl 0 $spacing-lg;
  padding-bottom: $spacing-sm;
  border-bottom: 2px solid $color-primary;
}

.demo-desc {
  color: $color-text-secondary;
  margin-bottom: $spacing-md;
}

.concept-content {
  h4 {
    color: $color-primary;
    margin: $spacing-md 0 $spacing-sm;
    
    &:first-child {
      margin-top: 0;
    }
  }
  
  ul {
    padding-left: $spacing-lg;
    
    li {
      margin-bottom: $spacing-xs;
      line-height: 1.8;
    }
  }
  
  code {
    background: $color-code-bg;
    padding: 2px 6px;
    border-radius: 4px;
    font-family: $font-family-code;
    color: $color-primary;
  }
}

.compare-table {
  width: 100%;
  border-collapse: collapse;
  
  th, td {
    padding: $spacing-sm $spacing-md;
    text-align: left;
    border: 1px solid $color-border;
  }
  
  th {
    background: $color-bg;
    font-weight: 600;
  }
  
  code {
    background: $color-code-bg;
    padding: 2px 6px;
    border-radius: 4px;
    font-family: $font-family-code;
    color: $color-primary;
  }
}
</style>

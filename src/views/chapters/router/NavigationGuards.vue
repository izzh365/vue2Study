<template>
  <div class="knowledge-page">
    <h2>ğŸ›¡ï¸ 8.5 å¯¼èˆªå®ˆå«</h2>
    <p class="page-desc">åœ¨è·¯ç”±å¯¼èˆªè¿‡ç¨‹ä¸­è¿›è¡Œæ‹¦æˆªå’Œæ£€æŸ¥ï¼Œå®ç°æƒé™æ§åˆ¶ç­‰åŠŸèƒ½</p>

    <!-- æ¦‚å¿µè¯´æ˜ -->
    <KnowledgeCard title="ğŸ“– ä»€ä¹ˆæ˜¯å¯¼èˆªå®ˆå«">
      <div class="concept-content">
        <div class="metaphor">
          <span class="icon">ğŸš§</span>
          <div>
            <strong>é€šä¿—æ¯”å–»ï¼šå°åŒºé—¨å«</strong>
            <p>å¯¼èˆªå®ˆå«å°±åƒå°åŒºé—¨å«ï¼Œåœ¨ä½ è¿›å…¥ï¼ˆè·¯ç”±åˆ‡æ¢ï¼‰ä¹‹å‰ä¼šæ£€æŸ¥ä½ çš„èº«ä»½ï¼ˆæƒé™ï¼‰ï¼Œåªæœ‰é€šè¿‡æ£€æŸ¥æ‰èƒ½æ”¾è¡Œã€‚</p>
          </div>
        </div>
        <div class="definition">
          <strong>å®˜æ–¹å®šä¹‰ï¼š</strong>
          å¯¼èˆªå®ˆå«ä¸»è¦ç”¨æ¥é€šè¿‡è·³è½¬æˆ–å–æ¶ˆçš„æ–¹å¼å®ˆå«å¯¼èˆªã€‚æœ‰å¤šç§æœºä¼šæ¤å…¥è·¯ç”±å¯¼èˆªè¿‡ç¨‹ä¸­ï¼šå…¨å±€çš„ã€å•ä¸ªè·¯ç”±ç‹¬äº«çš„ã€æˆ–è€…ç»„ä»¶çº§çš„ã€‚
        </div>
      </div>
    </KnowledgeCard>

    <!-- å®ˆå«ç±»å‹ -->
    <KnowledgeCard title="ğŸ”§ å®ˆå«ç±»å‹å¯¹æ¯”">
      <table class="guard-table">
        <thead>
          <tr>
            <th>ç±»å‹</th>
            <th>å®ˆå«</th>
            <th>å®šä¹‰ä½ç½®</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td rowspan="2"><strong>å…¨å±€å®ˆå«</strong></td>
            <td><code>beforeEach</code></td>
            <td>router å®ä¾‹</td>
          </tr>
          <tr>
            <td><code>afterEach</code></td>
            <td>router å®ä¾‹</td>
          </tr>
          <tr>
            <td><strong>è·¯ç”±ç‹¬äº«</strong></td>
            <td><code>beforeEnter</code></td>
            <td>è·¯ç”±é…ç½®</td>
          </tr>
          <tr>
            <td rowspan="3"><strong>ç»„ä»¶å†…å®ˆå«</strong></td>
            <td><code>beforeRouteEnter</code></td>
            <td>ç»„ä»¶é€‰é¡¹</td>
          </tr>
          <tr>
            <td><code>beforeRouteUpdate</code></td>
            <td>ç»„ä»¶é€‰é¡¹</td>
          </tr>
          <tr>
            <td><code>beforeRouteLeave</code></td>
            <td>ç»„ä»¶é€‰é¡¹</td>
          </tr>
        </tbody>
      </table>
    </KnowledgeCard>

    <!-- next å‚æ•° -->
    <KnowledgeCard title="ğŸ“ next å‡½æ•°ç”¨æ³•">
      <CodeBlock :code="nextSyntax" language="javascript" />
    </KnowledgeCard>

    <!-- Demo -->
    <KnowledgeCard title="ğŸ¯ Demo æ¼”ç¤º">
      <DemoBox 
        demoPath="router/guard-before-each" 
        title="Demo 1: å…¨å±€å‰ç½®å®ˆå« beforeEach" 
        :height="480"
      />
      
      <DemoBox 
        demoPath="router/guard-after-each" 
        title="Demo 2: å…¨å±€åç½®é’©å­ afterEach" 
        :height="400"
      />
      
      <DemoBox 
        demoPath="router/guard-before-enter" 
        title="Demo 3: è·¯ç”±ç‹¬äº«å®ˆå« beforeEnter" 
        :height="420"
      />
      
      <DemoBox 
        demoPath="router/guard-component" 
        title="Demo 4: ç»„ä»¶å†…å®ˆå«" 
        :height="500"
      />
      
      <DemoBox 
        demoPath="router/guard-login" 
        title="Demo 5: å®æˆ˜-ç™»å½•éªŒè¯" 
        :height="520"
      />
      
      <DemoBox 
        demoPath="router/guard-order" 
        title="Demo 6: å®ˆå«æ‰§è¡Œé¡ºåº" 
        :height="450"
      />
    </KnowledgeCard>

    <!-- æ‰§è¡Œé¡ºåº -->
    <KnowledgeCard title="â±ï¸ å®Œæ•´å¯¼èˆªè§£ææµç¨‹">
      <div class="flow-steps">
        <div class="step">1. å¯¼èˆªè¢«è§¦å‘</div>
        <div class="step">2. å¤±æ´»ç»„ä»¶ <code>beforeRouteLeave</code></div>
        <div class="step">3. å…¨å±€ <code>beforeEach</code></div>
        <div class="step">4. é‡ç”¨ç»„ä»¶ <code>beforeRouteUpdate</code></div>
        <div class="step">5. è·¯ç”± <code>beforeEnter</code></div>
        <div class="step">6. è§£æå¼‚æ­¥è·¯ç”±ç»„ä»¶</div>
        <div class="step">7. æ¿€æ´»ç»„ä»¶ <code>beforeRouteEnter</code></div>
        <div class="step">8. å…¨å±€ <code>afterEach</code></div>
        <div class="step">9. DOM æ›´æ–°</div>
        <div class="step">10. <code>beforeRouteEnter</code> çš„ next å›è°ƒ</div>
      </div>
    </KnowledgeCard>

    <!-- æ³¨æ„äº‹é¡¹ -->
    <TipBox type="warning" title="âš ï¸ æ³¨æ„äº‹é¡¹">
      <ul>
        <li><strong>å¿…é¡»è°ƒç”¨ next()ï¼š</strong>åœ¨ beforeEach ç­‰å®ˆå«ä¸­ï¼Œå¿…é¡»è°ƒç”¨ next() æ‰èƒ½ç»§ç»­å¯¼èˆª</li>
        <li><strong>beforeRouteEnter æ—  thisï¼š</strong>ç»„ä»¶è¿˜æœªåˆ›å»ºï¼Œå¯ç”¨ next(vm => {}) å›è°ƒ</li>
        <li><strong>é¿å…æ— é™å¾ªç¯ï¼š</strong>next('/login') æ—¶è¦æ³¨æ„æ¡ä»¶åˆ¤æ–­ï¼Œé˜²æ­¢å¾ªç¯é‡å®šå‘</li>
      </ul>
    </TipBox>

    <!-- æœ€ä½³å®è·µ -->
    <TipBox type="success" title="âœ… å¸¸è§åº”ç”¨åœºæ™¯">
      <ul>
        <li>ç™»å½•éªŒè¯ï¼šæœªç™»å½•è·³è½¬ç™»å½•é¡µ</li>
        <li>æƒé™æ§åˆ¶ï¼šæ— æƒé™æ˜¾ç¤º 403</li>
        <li>é¡µé¢æ ‡é¢˜ï¼šæ ¹æ®è·¯ç”±åŠ¨æ€è®¾ç½® title</li>
        <li>é¡µé¢åŠ è½½è¿›åº¦æ¡</li>
        <li>ç¦»å¼€é¡µé¢ç¡®è®¤ï¼ˆè¡¨å•æœªä¿å­˜æç¤ºï¼‰</li>
      </ul>
    </TipBox>
  </div>
</template>

<script>
import KnowledgeCard from '@/components/content/KnowledgeCard.vue'
import TipBox from '@/components/content/TipBox.vue'
import DemoBox from '@/components/demo/DemoBox.vue'
import CodeBlock from '@/components/demo/CodeBlock.vue'
import scrollTrackingMixin from '@/utils/scrollTrackingMixin'

export default {
  name: 'NavigationGuards',
  mixins: [scrollTrackingMixin],
  components: {
    KnowledgeCard,
    TipBox,
    DemoBox,
    CodeBlock
  },
  data() {
    return {
      nextSyntax: `// æ”¾è¡Œï¼Œç»§ç»­å¯¼èˆª
next()

// ä¸­æ–­å¯¼èˆª
next(false)

// è·³è½¬åˆ°å…¶ä»–è·¯ç”±
next('/login')
next({ path: '/login' })
next({ name: 'login', query: { redirect: to.fullPath }})

// ä¼ é€’ Error
next(new Error('å¯¼èˆªå¤±è´¥'))

// beforeRouteEnter ä¸­è®¿é—® vm
next(vm => {
  // é€šè¿‡ vm è®¿é—®ç»„ä»¶å®ä¾‹
  console.log(vm.someData)
})`
    }
  }
}
</script>

<style lang="scss" scoped>
.knowledge-page {
  max-width: 900px;
  margin: 0 auto;
  
  h2 {
    font-size: 28px;
    margin-bottom: 8px;
  }
  
  .page-desc {
    color: $color-text-secondary;
    margin-bottom: 24px;
  }
}

.concept-content {
  .metaphor {
    display: flex;
    gap: 16px;
    padding: 16px;
    background: linear-gradient(135deg, #fff3e0, #e8f5e9);
    border-radius: 12px;
    margin-bottom: 16px;
    
    .icon { font-size: 36px; }
    
    strong {
      color: $color-text;
      display: block;
      margin-bottom: 4px;
    }
    
    p {
      color: $color-text-secondary;
      font-size: 14px;
      margin: 0;
    }
  }
  
  .definition {
    padding: 12px;
    background: $color-code-bg;
    border-radius: 8px;
    font-size: 14px;
  }
}

.guard-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
  
  th, td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid $color-border;
  }
  
  th {
    background: $color-bg;
    font-weight: 600;
  }
  
  td[rowspan] {
    vertical-align: middle;
    background: #fafafa;
  }
  
  code {
    background: rgba(0, 122, 255, 0.1);
    padding: 2px 6px;
    border-radius: 4px;
    color: $color-primary;
  }
}

.flow-steps {
  display: flex;
  flex-direction: column;
  gap: 8px;
  
  .step {
    padding: 10px 16px;
    background: $color-bg;
    border-radius: 8px;
    font-size: 14px;
    position: relative;
    padding-left: 40px;
    
    &::before {
      content: '';
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      width: 8px;
      height: 8px;
      background: $color-primary;
      border-radius: 50%;
    }
    
    code {
      background: rgba(0, 122, 255, 0.1);
      padding: 2px 6px;
      border-radius: 4px;
      color: $color-primary;
    }
  }
}
</style>

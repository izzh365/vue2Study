<template>
  <div class="knowledge-page">
    <!-- æ¦‚å¿µè¯´æ˜ -->
    <KnowledgeCard title="ğŸ“– ä»€ä¹ˆæ˜¯ Actions">
      <div class="concept-content">
        <div class="metaphor">
          <div class="metaphor-icon">ğŸ“‹</div>
          <div class="metaphor-text">
            <strong>é€šä¿—æ¯”å–»ï¼š</strong>Actions å°±åƒ<strong>ç»ç†ä¸‹è¾¾çš„å·¥ä½œæŒ‡ä»¤</strong>ã€‚
            ç»ç†ï¼ˆActionï¼‰ä¸ä¼šç›´æ¥åŠ¨æ‰‹ä¿®æ”¹ä»“åº“ï¼Œè€Œæ˜¯å®‰æ’å¥½å·¥ä½œè®¡åˆ’åï¼Œ
            è®©ä»“åº“ç®¡ç†å‘˜ï¼ˆMutationï¼‰å»æ‰§è¡Œå®é™…æ“ä½œã€‚ç»ç†å¯ä»¥åŒæ—¶å®‰æ’å¤šä¸ªä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥ç­‰ä¸€ä¸ªä»»åŠ¡å®Œæˆåå†å®‰æ’ä¸‹ä¸€ä¸ªã€‚
          </div>
        </div>
        
        <div class="definition-box">
          <h4>ğŸ“š å®˜æ–¹å®šä¹‰</h4>
          <p><strong>Actions</strong> ç±»ä¼¼äº mutationsï¼Œä½†æœ‰ä¸¤ç‚¹ä¸åŒï¼š</p>
          <ul>
            <li>Action <strong>æäº¤çš„æ˜¯ mutation</strong>ï¼Œè€Œä¸æ˜¯ç›´æ¥å˜æ›´çŠ¶æ€</li>
            <li>Action å¯ä»¥åŒ…å«ä»»æ„<strong>å¼‚æ­¥æ“ä½œ</strong></li>
          </ul>
        </div>
        
        <div class="compare-table-section">
          <h4>âš–ï¸ Actions vs Mutations</h4>
          <table class="compare-table">
            <thead>
              <tr>
                <th>ç‰¹æ€§</th>
                <th>Mutations</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>è§¦å‘æ–¹å¼</td>
                <td><code>commit</code></td>
                <td><code>dispatch</code></td>
              </tr>
              <tr>
                <td>å¼‚æ­¥æ“ä½œ</td>
                <td>âŒ ä¸å¯ä»¥</td>
                <td>âœ… å¯ä»¥</td>
              </tr>
              <tr>
                <td>ä¿®æ”¹ state</td>
                <td>âœ… ç›´æ¥ä¿®æ”¹</td>
                <td>âŒ é€šè¿‡ commit mutation</td>
              </tr>
              <tr>
                <td>è¿”å›å€¼</td>
                <td>æ— </td>
                <td>å¯è¿”å› Promise</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </KnowledgeCard>

    <!-- è¯­æ³•æ ¼å¼ -->
    <KnowledgeCard title="ğŸ“ è¯­æ³•æ ¼å¼">
      <div class="syntax-section">
        <h4>åŸºæœ¬ Action å®šä¹‰</h4>
        <CodeBlock :code="basicAction" language="javascript" />
        
        <h4>åˆ†å‘ Action</h4>
        <CodeBlock :code="dispatchAction" language="javascript" />
        
        <h4>å¼‚æ­¥ Actionï¼ˆè¿”å› Promiseï¼‰</h4>
        <CodeBlock :code="asyncAction" language="javascript" />
        
        <h4>ç»„åˆ Actions</h4>
        <CodeBlock :code="composeActions" language="javascript" />
      </div>
    </KnowledgeCard>

    <!-- Demo: åŸºç¡€ç”¨æ³• -->
    <KnowledgeCard title="ğŸ¯ Demo 1: Actions åŸºç¡€ç”¨æ³•">
      <DemoBox 
        demoPath="vuex/actions-basic"
        title="å¼‚æ­¥è®¡æ•°å™¨"
        :height="'380px'"
      />
    </KnowledgeCard>

    <!-- Demo: å¼‚æ­¥è¯·æ±‚ -->
    <KnowledgeCard title="ğŸ¯ Demo 2: å¼‚æ­¥è¯·æ±‚æ•°æ®">
      <DemoBox 
        demoPath="vuex/actions-async"
        title="æ¨¡æ‹Ÿ API è¯·æ±‚"
        :height="'420px'"
      />
    </KnowledgeCard>

    <!-- Demo: Promise è¿”å› -->
    <KnowledgeCard title="ğŸ¯ Demo 3: Action è¿”å› Promise">
      <DemoBox 
        demoPath="vuex/actions-promise"
        title="ç­‰å¾… Action å®Œæˆ"
        :height="'380px'"
      />
    </KnowledgeCard>

    <!-- Demo: mapActions -->
    <KnowledgeCard title="ğŸ¯ Demo 4: mapActions è¾…åŠ©å‡½æ•°">
      <DemoBox 
        demoPath="vuex/actions-map"
        title="ä½¿ç”¨ mapActions ç®€åŒ–ä»£ç "
        :height="'380px'"
      />
    </KnowledgeCard>

    <!-- Demo: ç»„åˆ Actions -->
    <KnowledgeCard title="ğŸ¯ Demo 5: ç»„åˆ Actions">
      <DemoBox 
        demoPath="vuex/actions-compose"
        title="Action ä¸­è°ƒç”¨å…¶ä»– Action"
        :height="'400px'"
      />
    </KnowledgeCard>

    <!-- Context å‚æ•° -->
    <TipBox type="info" title="ğŸ’¡ Action çš„ Context å‚æ•°">
      <p>Action å‡½æ•°æ¥æ”¶ä¸€ä¸ª <strong>context</strong> å¯¹è±¡ï¼ŒåŒ…å«ä»¥ä¸‹å±æ€§ï¼š</p>
      <ul>
        <li><code>commit</code> - æäº¤ mutation</li>
        <li><code>dispatch</code> - åˆ†å‘å…¶ä»– action</li>
        <li><code>state</code> - å½“å‰æ¨¡å—çš„ state</li>
        <li><code>getters</code> - å½“å‰æ¨¡å—çš„ getters</li>
        <li><code>rootState</code> - æ ¹æ¨¡å—çš„ stateï¼ˆæ¨¡å—åŒ–æ—¶ï¼‰</li>
        <li><code>rootGetters</code> - æ ¹æ¨¡å—çš„ gettersï¼ˆæ¨¡å—åŒ–æ—¶ï¼‰</li>
      </ul>
    </TipBox>

    <!-- æ³¨æ„äº‹é¡¹ -->
    <TipBox type="warning" title="âš ï¸ æ³¨æ„äº‹é¡¹">
      <ul>
        <li><strong>ä¸è¦åœ¨ Action ä¸­ç›´æ¥ä¿®æ”¹ stateï¼š</strong>å¿…é¡»é€šè¿‡ commit mutation</li>
        <li><strong>Action ä¸­çš„é”™è¯¯è¦å¦¥å–„å¤„ç†ï¼š</strong>ä½¿ç”¨ try-catch æˆ– Promise.catch</li>
        <li><strong>å¤æ‚é€»è¾‘æ”¾åœ¨ Action ä¸­ï¼š</strong>ä¿æŒ mutation ç®€å•çº¯ç²¹</li>
      </ul>
    </TipBox>

    <!-- æœ€ä½³å®è·µ -->
    <TipBox type="success" title="âœ… æœ€ä½³å®è·µ">
      <ul>
        <li>API è¯·æ±‚ç»Ÿä¸€æ”¾åœ¨ actions ä¸­å¤„ç†</li>
        <li>Action è¿”å› Promise ä¾¿äºè°ƒç”¨æ–¹çŸ¥é“ä½•æ—¶å®Œæˆ</li>
        <li>ä½¿ç”¨ async/await ä½¿ä»£ç æ›´æ¸…æ™°</li>
        <li>ä½¿ç”¨ <code>mapActions</code> ç®€åŒ–ç»„ä»¶ä¸­çš„ä»£ç </li>
      </ul>
    </TipBox>
  </div>
</template>

<script>
import KnowledgeCard from '@/components/content/KnowledgeCard.vue'
import TipBox from '@/components/content/TipBox.vue'
import CodeBlock from '@/components/demo/CodeBlock.vue'
import DemoBox from '@/components/demo/DemoBox.vue'
import scrollTrackingMixin from '@/utils/scrollTrackingMixin'

export default {
  name: 'VuexActions',
  
  mixins: [scrollTrackingMixin],
  
  components: {
    KnowledgeCard,
    TipBox,
    CodeBlock,
    DemoBox
  },
  
  data() {
    return {
      basicAction: `const store = new Vuex.Store({
  state: {
    count: 0
  },
  mutations: {
    increment(state) {
      state.count++
    }
  },
  actions: {
    // Action æ¥æ”¶ context å¯¹è±¡
    // é€šå¸¸ä½¿ç”¨è§£æ„è·å– commit
    increment({ commit }) {
      commit('increment')
    },
    
    // å¼‚æ­¥ Action
    incrementAsync({ commit }) {
      setTimeout(() => {
        commit('increment')
      }, 1000)
    }
  }
})`,

      dispatchAction: `// æ–¹å¼1ï¼šåœ¨ç»„ä»¶ä¸­åˆ†å‘
this.$store.dispatch('increment')

// æ–¹å¼2ï¼šå¸¦ payload
this.$store.dispatch('incrementAsync', { amount: 10 })

// æ–¹å¼3ï¼šå¯¹è±¡é£æ ¼
this.$store.dispatch({
  type: 'incrementAsync',
  amount: 10
})`,

      asyncAction: `actions: {
  // è¿”å› Promise
  fetchUser({ commit }, userId) {
    return new Promise((resolve, reject) => {
      api.getUser(userId)
        .then(user => {
          commit('SET_USER', user)
          resolve(user)
        })
        .catch(error => {
          reject(error)
        })
    })
  },
  
  // ä½¿ç”¨ async/awaitï¼ˆæ¨èï¼‰
  async fetchUser({ commit }, userId) {
    try {
      const user = await api.getUser(userId)
      commit('SET_USER', user)
      return user
    } catch (error) {
      throw error
    }
  }
}`,

      composeActions: `actions: {
  // Action A
  actionA({ commit }) {
    return new Promise(resolve => {
      setTimeout(() => {
        commit('someMutation')
        resolve()
      }, 1000)
    })
  },
  
  // Action B ç­‰å¾… Action A å®Œæˆåæ‰§è¡Œ
  async actionB({ dispatch, commit }) {
    await dispatch('actionA')
    commit('someOtherMutation')
  }
}`
    }
  }
}
</script>

<style lang="scss" scoped>
.knowledge-page {
  max-width: 1000px;
  margin: 0 auto;
}

.concept-content {
  .metaphor {
    display: flex;
    gap: 16px;
    padding: 16px;
    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
    border-radius: 12px;
    margin-bottom: 20px;
    
    .metaphor-icon {
      font-size: 32px;
    }
    
    .metaphor-text {
      font-size: 15px;
      line-height: 1.6;
    }
  }
  
  .definition-box {
    background: #f8f9fa;
    padding: 16px;
    border-radius: 8px;
    margin-bottom: 20px;
    
    h4 {
      margin-bottom: 8px;
      color: #1d1d1f;
    }
    
    p {
      color: #666;
      line-height: 1.6;
      margin-bottom: 8px;
    }
    
    ul {
      margin: 0;
      padding-left: 20px;
      color: #666;
      
      li {
        margin-bottom: 4px;
      }
    }
  }
  
  .compare-table-section {
    h4 {
      margin-bottom: 12px;
      color: #1d1d1f;
    }
    
    .compare-table {
      width: 100%;
      border-collapse: collapse;
      
      th, td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #e5e5ea;
      }
      
      th {
        background: #f8f9fa;
        font-weight: 600;
        color: #1d1d1f;
      }
      
      td {
        color: #666;
      }
      
      code {
        background: #f0f0f5;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 13px;
      }
    }
  }
}

.syntax-section {
  h4 {
    margin-bottom: 12px;
    color: #1d1d1f;
    font-size: 15px;
    
    &:not(:first-child) {
      margin-top: 24px;
    }
  }
}
</style>

<template>
  <div class="knowledge-page">
    <!-- æ¦‚å¿µè¯´æ˜ -->
    <KnowledgeCard title="ğŸ“– ä»€ä¹ˆæ˜¯ Getters">
      <div class="concept-content">
        <div class="metaphor">
          <div class="metaphor-icon">ğŸ”</div>
          <div class="metaphor-text">
            <strong>é€šä¿—æ¯”å–»ï¼š</strong>Getters å°±åƒ<strong>è¶…å¸‚çš„ä¿ƒé”€å‘˜</strong>ã€‚
            ä»“åº“ï¼ˆStateï¼‰é‡Œæœ‰å¾ˆå¤šå•†å“ï¼Œä¿ƒé”€å‘˜ä¸æ”¹å˜å•†å“ï¼Œåªæ˜¯å¸®ä½ <strong>ç­›é€‰ã€è®¡ç®—ã€å±•ç¤º</strong>ä½ éœ€è¦çš„ä¿¡æ¯ã€‚
          </div>
        </div>
        
        <div class="definition-box">
          <h4>ğŸ“š å®˜æ–¹å®šä¹‰</h4>
          <p><strong>Getters</strong> æ˜¯ Vuex çš„è®¡ç®—å±æ€§ã€‚å½“éœ€è¦ä» state ä¸­æ´¾ç”Ÿå‡ºä¸€äº›çŠ¶æ€æ—¶ä½¿ç”¨ï¼Œä¾‹å¦‚å¯¹åˆ—è¡¨è¿›è¡Œè¿‡æ»¤ã€ç»Ÿè®¡æ•°é‡ç­‰ã€‚</p>
          <p>Getters æ¥æ”¶ state ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¿”å›å¤„ç†åçš„æ•°æ®ã€‚</p>
        </div>
        
        <div class="feature-list">
          <div class="feature-item">
            <span class="feature-icon">âš¡</span>
            <div>
              <strong>å“åº”å¼ç¼“å­˜</strong>
              <p>åªæœ‰ä¾èµ–çš„ state å˜åŒ–æ—¶æ‰ä¼šé‡æ–°è®¡ç®—</p>
            </div>
          </div>
          <div class="feature-item">
            <span class="feature-icon">ğŸ“¦</span>
            <div>
              <strong>å¯å¤ç”¨</strong>
              <p>åœ¨å¤šä¸ªç»„ä»¶ä¸­å…±äº«åŒä¸€ä¸ªè®¡ç®—é€»è¾‘</p>
            </div>
          </div>
          <div class="feature-item">
            <span class="feature-icon">ğŸ”—</span>
            <div>
              <strong>å¯ç»„åˆ</strong>
              <p>Getters å¯ä»¥è°ƒç”¨å…¶ä»– getters</p>
            </div>
          </div>
        </div>
      </div>
    </KnowledgeCard>

    <!-- Getters vs Computed -->
    <KnowledgeCard title="ğŸ’¡ Getters vs ç»„ä»¶ Computed">
      <div class="compare-section">
        <table class="compare-table">
          <thead>
            <tr>
              <th>ç‰¹æ€§</th>
              <th>ç»„ä»¶ Computed</th>
              <th>Vuex Getters</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>ä½œç”¨èŒƒå›´</td>
              <td>ä»…å½“å‰ç»„ä»¶</td>
              <td>å…¨å±€å¯ç”¨</td>
            </tr>
            <tr>
              <td>æ•°æ®æ¥æº</td>
              <td>ç»„ä»¶ dataã€props</td>
              <td>Store state</td>
            </tr>
            <tr>
              <td>å¤ç”¨æ€§</td>
              <td>éœ€è¦åœ¨æ¯ä¸ªç»„ä»¶é‡å¤å®šä¹‰</td>
              <td>å®šä¹‰ä¸€æ¬¡ï¼Œå¤„å¤„ä½¿ç”¨</td>
            </tr>
            <tr>
              <td>ç¼“å­˜</td>
              <td>âœ… æœ‰ç¼“å­˜</td>
              <td>âœ… æœ‰ç¼“å­˜</td>
            </tr>
          </tbody>
        </table>
        
        <div class="tip-inline">
          ğŸ’¡ å¦‚æœæ´¾ç”Ÿé€»è¾‘åªåœ¨ä¸€ä¸ªç»„ä»¶ä½¿ç”¨ï¼Œç”¨ computedï¼›å¦‚æœå¤šä¸ªç»„ä»¶éœ€è¦ï¼Œç”¨ gettersï¼
        </div>
      </div>
    </KnowledgeCard>

    <!-- è¯­æ³•æ ¼å¼ -->
    <KnowledgeCard title="ğŸ“ è¯­æ³•æ ¼å¼">
      <div class="syntax-section">
        <h4>åŸºæœ¬ Getter å®šä¹‰</h4>
        <CodeBlock :code="basicSyntax" language="javascript" />
        
        <h4>è®¿é—®å…¶ä»– Getters</h4>
        <CodeBlock :code="accessOtherGetters" language="javascript" />
        
        <h4>è¿”å›å‡½æ•°ï¼ˆå¸¦å‚æ•°ï¼‰</h4>
        <CodeBlock :code="returnFunction" language="javascript" />
      </div>
    </KnowledgeCard>

    <!-- Demo: åŸºç¡€ç”¨æ³• -->
    <KnowledgeCard title="ğŸ¯ Demo 1: Getters åŸºç¡€ç”¨æ³•">
      <DemoBox 
        demoPath="vuex/getters-basic"
        title="è¿‡æ»¤å·²å®Œæˆçš„å¾…åŠäº‹é¡¹"
        :height="'380px'"
      />
    </KnowledgeCard>

    <!-- Demo: æ¥æ”¶å…¶ä»– getters -->
    <KnowledgeCard title="ğŸ¯ Demo 2: Getter è®¿é—®å…¶ä»– Getter">
      <DemoBox 
        demoPath="vuex/getters-compose"
        title="ç»„åˆ Getters å®ç°å¤æ‚è®¡ç®—"
        :height="'380px'"
      />
    </KnowledgeCard>

    <!-- Demo: è¿”å›å‡½æ•° -->
    <KnowledgeCard title="ğŸ¯ Demo 3: Getter è¿”å›å‡½æ•°ï¼ˆå¸¦å‚æ•°ï¼‰">
      <DemoBox 
        demoPath="vuex/getters-method"
        title="é€šè¿‡ ID æŸ¥æ‰¾ Todo"
        :height="'350px'"
      />
    </KnowledgeCard>

    <!-- Demo: mapGetters -->
    <KnowledgeCard title="ğŸ¯ Demo 4: mapGetters è¾…åŠ©å‡½æ•°">
      <DemoBox 
        demoPath="vuex/getters-mapgetters"
        title="ä½¿ç”¨ mapGetters ç®€åŒ–ä»£ç "
        :height="'400px'"
      />
    </KnowledgeCard>

    <!-- Demo: å®æˆ˜æ¡ˆä¾‹ -->
    <KnowledgeCard title="ğŸ¯ Demo 5: è´­ç‰©è½¦æ¡ˆä¾‹">
      <DemoBox 
        demoPath="vuex/getters-cart"
        title="è´­ç‰©è½¦è®¡ç®—æ€»ä»·ã€æ€»æ•°"
        :height="'420px'"
      />
    </KnowledgeCard>

    <!-- æ³¨æ„äº‹é¡¹ -->
    <TipBox type="warning" title="âš ï¸ æ³¨æ„äº‹é¡¹">
      <ul>
        <li><strong>é€šè¿‡æ–¹æ³•è®¿é—®ä¸ç¼“å­˜ï¼š</strong>å½“ getter è¿”å›å‡½æ•°æ—¶ï¼ˆå¦‚ <code>getTodoById(id)</code>ï¼‰ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½ä¼šæ‰§è¡Œï¼Œä¸ä¼šç¼“å­˜</li>
        <li><strong>ä¸è¦ä¿®æ”¹ stateï¼š</strong>Getters åªèƒ½è¯»å– stateï¼Œä¸èƒ½ä¿®æ”¹å®ƒ</li>
        <li><strong>é¿å…å¤æ‚é€»è¾‘ï¼š</strong>å¦‚æœè®¡ç®—é€»è¾‘è¿‡äºå¤æ‚ï¼Œè€ƒè™‘åœ¨ actions ä¸­é¢„å¤„ç†</li>
      </ul>
    </TipBox>

    <!-- æœ€ä½³å®è·µ -->
    <TipBox type="success" title="âœ… æœ€ä½³å®è·µ">
      <ul>
        <li>å°†å¸¸ç”¨çš„è¿‡æ»¤ã€ç»Ÿè®¡é€»è¾‘æŠ½å–ä¸º getters</li>
        <li>ä½¿ç”¨ <code>mapGetters</code> é…åˆå±•å¼€è¿ç®—ç¬¦ç®€åŒ–ç»„ä»¶ä»£ç </li>
        <li>ä¸º getters èµ·æœ‰æ„ä¹‰çš„åå­—ï¼Œå¦‚ <code>completedTodos</code>ã€<code>totalPrice</code></li>
        <li>å¤æ‚ getters å¯ä»¥ç»„åˆä½¿ç”¨ç®€å• getters</li>
      </ul>
    </TipBox>
  </div>
</template>

<script>
import KnowledgeCard from '@/components/content/KnowledgeCard.vue'
import TipBox from '@/components/content/TipBox.vue'
import CodeBlock from '@/components/demo/CodeBlock.vue'
import DemoBox from '@/components/demo/DemoBox.vue'
import scrollTrackingMixin from '@/utils/scrollTrackingMixin'

export default {
  name: 'VuexGetters',
  
  mixins: [scrollTrackingMixin],
  
  components: {
    KnowledgeCard,
    TipBox,
    CodeBlock,
    DemoBox
  },
  
  data() {
    return {
      basicSyntax: `const store = new Vuex.Store({
  state: {
    todos: [
      { id: 1, text: 'å­¦ä¹  Vue', done: true },
      { id: 2, text: 'å­¦ä¹  Vuex', done: false }
    ]
  },
  getters: {
    // Getter æ¥æ”¶ state ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°
    doneTodos(state) {
      return state.todos.filter(todo => todo.done)
    }
  }
})

// è®¿é—® getterï¼ˆå±æ€§è®¿é—®æ–¹å¼ï¼Œæœ‰ç¼“å­˜ï¼‰
store.getters.doneTodos  // [{ id: 1, text: 'å­¦ä¹  Vue', done: true }]`,

      accessOtherGetters: `getters: {
  doneTodos(state) {
    return state.todos.filter(todo => todo.done)
  },
  
  // ç¬¬äºŒä¸ªå‚æ•° gettersï¼Œå¯ä»¥è®¿é—®å…¶ä»– getter
  doneTodosCount(state, getters) {
    return getters.doneTodos.length
  }
}`,

      returnFunction: `getters: {
  // è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥ä¼ é€’å‚æ•°
  getTodoById: (state) => (id) => {
    return state.todos.find(todo => todo.id === id)
  }
}

// ä½¿ç”¨æ—¶ä¼ å…¥å‚æ•°ï¼ˆæ–¹æ³•è®¿é—®æ–¹å¼ï¼Œä¸ç¼“å­˜ï¼‰
store.getters.getTodoById(2)  // { id: 2, text: 'å­¦ä¹  Vuex', done: false }`
    }
  }
}
</script>

<style lang="scss" scoped>
.knowledge-page {
  max-width: 1000px;
  margin: 0 auto;
}

.concept-content {
  .metaphor {
    display: flex;
    gap: 16px;
    padding: 16px;
    background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
    border-radius: 12px;
    margin-bottom: 20px;
    
    .metaphor-icon {
      font-size: 32px;
    }
    
    .metaphor-text {
      font-size: 15px;
      line-height: 1.6;
    }
  }
  
  .definition-box {
    background: #f8f9fa;
    padding: 16px;
    border-radius: 8px;
    margin-bottom: 20px;
    
    h4 {
      margin-bottom: 8px;
      color: #1d1d1f;
    }
    
    p {
      color: #666;
      line-height: 1.6;
      margin-bottom: 8px;
      
      &:last-child {
        margin-bottom: 0;
      }
    }
  }
  
  .feature-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    
    .feature-item {
      display: flex;
      gap: 12px;
      padding: 16px;
      background: #f0f0f5;
      border-radius: 8px;
      
      .feature-icon {
        font-size: 24px;
      }
      
      strong {
        display: block;
        margin-bottom: 4px;
        color: #1d1d1f;
      }
      
      p {
        font-size: 13px;
        color: #86868b;
        margin: 0;
      }
    }
  }
}

.compare-section {
  .compare-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 16px;
    
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e5e5ea;
    }
    
    th {
      background: #f8f9fa;
      font-weight: 600;
      color: #1d1d1f;
    }
    
    td {
      color: #666;
    }
    
    tr:last-child td {
      border-bottom: none;
    }
  }
  
  .tip-inline {
    background: #e3f2fd;
    padding: 12px;
    border-radius: 8px;
    font-size: 14px;
    color: #1976d2;
  }
}

.syntax-section {
  h4 {
    margin-bottom: 12px;
    color: #1d1d1f;
    font-size: 15px;
    
    &:not(:first-child) {
      margin-top: 24px;
    }
  }
}
</style>

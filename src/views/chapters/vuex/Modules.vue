<template>
  <div class="knowledge-page">
    <!-- æ¦‚å¿µè¯´æ˜ -->
    <KnowledgeCard title="ğŸ“– ä»€ä¹ˆæ˜¯ Modules">
      <div class="concept-content">
        <div class="metaphor">
          <div class="metaphor-icon">ğŸ¢</div>
          <div class="metaphor-text">
            <strong>é€šä¿—æ¯”å–»ï¼š</strong>Modules å°±åƒ<strong>å…¬å¸çš„éƒ¨é—¨</strong>ã€‚
            å½“å…¬å¸è§„æ¨¡å˜å¤§åï¼Œä¸èƒ½æ‰€æœ‰äº‹æƒ…éƒ½ç”±æ€»ç»ç†ç›´æ¥ç®¡ç†ï¼Œéœ€è¦åˆ†æˆç ”å‘éƒ¨ã€å¸‚åœºéƒ¨ã€è´¢åŠ¡éƒ¨ç­‰ã€‚
            æ¯ä¸ªéƒ¨é—¨æœ‰è‡ªå·±çš„èŒè´£å’Œäººå‘˜ï¼ˆstateï¼‰ï¼Œæœ‰è‡ªå·±çš„å·¥ä½œæµç¨‹ï¼ˆmutations/actionsï¼‰ã€‚
          </div>
        </div>
        
        <div class="definition-box">
          <h4>ğŸ“š å®˜æ–¹å®šä¹‰</h4>
          <p>ç”±äºä½¿ç”¨å•ä¸€çŠ¶æ€æ ‘ï¼Œåº”ç”¨çš„æ‰€æœ‰çŠ¶æ€ä¼šé›†ä¸­åˆ°ä¸€ä¸ªæ¯”è¾ƒå¤§çš„å¯¹è±¡ã€‚å½“åº”ç”¨å˜å¾—éå¸¸å¤æ‚æ—¶ï¼Œstore å¯¹è±¡å°±æœ‰å¯èƒ½å˜å¾—ç›¸å½“è‡ƒè‚¿ã€‚</p>
          <p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒVuex å…è®¸æˆ‘ä»¬å°† store åˆ†å‰²æˆ<strong>æ¨¡å—ï¼ˆmoduleï¼‰</strong>ã€‚æ¯ä¸ªæ¨¡å—æ‹¥æœ‰è‡ªå·±çš„ stateã€mutationã€actionã€getterã€ç”šè‡³æ˜¯åµŒå¥—å­æ¨¡å—ã€‚</p>
        </div>
        
        <div class="structure-box">
          <h4>ğŸ—‚ï¸ æ¨¡å—åŒ–ç»“æ„</h4>
          <div class="tree-structure">
            <pre>
store/
â”œâ”€â”€ index.js          # ç»„è£…æ¨¡å—å¹¶å¯¼å‡º store
â”œâ”€â”€ state.js          # æ ¹çº§åˆ«çŠ¶æ€
â”œâ”€â”€ mutations.js      # æ ¹çº§åˆ« mutations
â””â”€â”€ modules/
    â”œâ”€â”€ user.js       # ç”¨æˆ·æ¨¡å—
    â”œâ”€â”€ cart.js       # è´­ç‰©è½¦æ¨¡å—
    â””â”€â”€ product.js    # å•†å“æ¨¡å—</pre>
          </div>
        </div>
      </div>
    </KnowledgeCard>

    <!-- è¯­æ³•æ ¼å¼ -->
    <KnowledgeCard title="ğŸ“ è¯­æ³•æ ¼å¼">
      <div class="syntax-section">
        <h4>åŸºç¡€æ¨¡å—å®šä¹‰</h4>
        <CodeBlock :code="basicModule" language="javascript" />
        
        <h4>å‘½åç©ºé—´æ¨¡å—</h4>
        <CodeBlock :code="namespacedModule" language="javascript" />
        
        <h4>è®¿é—®å‘½åç©ºé—´æ¨¡å—</h4>
        <CodeBlock :code="accessNamespaced" language="javascript" />
      </div>
    </KnowledgeCard>

    <!-- Demo: åŸºç¡€æ¨¡å— -->
    <KnowledgeCard title="ğŸ¯ Demo 1: åŸºç¡€æ¨¡å—">
      <DemoBox 
        demoPath="vuex/modules-basic"
        title="åˆ†å‰² Store ä¸ºæ¨¡å—"
        :height="'400px'"
      />
    </KnowledgeCard>

    <!-- Demo: å‘½åç©ºé—´ -->
    <KnowledgeCard title="ğŸ¯ Demo 2: å‘½åç©ºé—´">
      <DemoBox 
        demoPath="vuex/modules-namespace"
        title="namespaced: true çš„ä½œç”¨"
        :height="'420px'"
      />
    </KnowledgeCard>

    <!-- Demo: è®¿é—®æ ¹çŠ¶æ€ -->
    <KnowledgeCard title="ğŸ¯ Demo 3: è®¿é—®æ ¹çŠ¶æ€">
      <DemoBox 
        demoPath="vuex/modules-root"
        title="æ¨¡å—ä¸­è®¿é—® rootState å’Œ rootGetters"
        :height="'400px'"
      />
    </KnowledgeCard>

    <!-- Demo: mapState ä¸æ¨¡å— -->
    <KnowledgeCard title="ğŸ¯ Demo 4: mapState ä¸æ¨¡å—">
      <DemoBox 
        demoPath="vuex/modules-map"
        title="åœ¨ç»„ä»¶ä¸­ä½¿ç”¨æ¨¡å—åŒ–è¾…åŠ©å‡½æ•°"
        :height="'420px'"
      />
    </KnowledgeCard>

    <!-- Demo: ç»¼åˆæ¡ˆä¾‹ -->
    <KnowledgeCard title="ğŸ¯ Demo 5: ç»¼åˆæ¡ˆä¾‹ - ç”¨æˆ·ä¸è´­ç‰©è½¦">
      <DemoBox 
        demoPath="vuex/modules-cart"
        title="å¤šæ¨¡å—åä½œç¤ºä¾‹"
        :height="'480px'"
      />
    </KnowledgeCard>

    <!-- å‘½åç©ºé—´è¯´æ˜ -->
    <TipBox type="info" title="ğŸ’¡ å‘½åç©ºé—´çš„ä½œç”¨">
      <p>è®¾ç½® <code>namespaced: true</code> åï¼š</p>
      <ul>
        <li>gettersã€actionsã€mutations ä¼šè‡ªåŠ¨åŠ ä¸Šæ¨¡å—è·¯å¾„å‰ç¼€</li>
        <li><code>getters['user/profile']</code> æ›¿ä»£ <code>getters.profile</code></li>
        <li><code>dispatch('user/login')</code> æ›¿ä»£ <code>dispatch('login')</code></li>
        <li>é¿å…ä¸åŒæ¨¡å—ä¹‹é—´çš„å‘½åå†²çª</li>
      </ul>
    </TipBox>

    <!-- æ³¨æ„äº‹é¡¹ -->
    <TipBox type="warning" title="âš ï¸ æ³¨æ„äº‹é¡¹">
      <ul>
        <li><strong>æ¨¡å—çš„ state å¿…é¡»æ˜¯å‡½æ•°ï¼š</strong>è¿”å›å¯¹è±¡ï¼Œé¿å…çŠ¶æ€å…±äº«</li>
        <li><strong>å‘½åç©ºé—´æ¨¡å—è®¿é—®æ ¹çŠ¶æ€ï¼š</strong>ä½¿ç”¨ rootState å’Œ rootGetters</li>
        <li><strong>åœ¨æ¨¡å—ä¸­æäº¤æ ¹ mutationï¼š</strong>ä¼ å…¥ <code>{ root: true }</code></li>
      </ul>
    </TipBox>

    <!-- æœ€ä½³å®è·µ -->
    <TipBox type="success" title="âœ… æœ€ä½³å®è·µ">
      <ul>
        <li>æŒ‰åŠŸèƒ½åˆ’åˆ†æ¨¡å—ï¼ˆç”¨æˆ·ã€å•†å“ã€è´­ç‰©è½¦ç­‰ï¼‰</li>
        <li>ç»Ÿä¸€ä½¿ç”¨å‘½åç©ºé—´ï¼Œä¾¿äºç»´æŠ¤</li>
        <li>ä½¿ç”¨ <code>createNamespacedHelpers</code> ç®€åŒ–ç»„ä»¶ä»£ç </li>
        <li>ä¿æŒæ¨¡å—ç‹¬ç«‹ï¼Œå‡å°‘æ¨¡å—é—´çš„ç›´æ¥ä¾èµ–</li>
      </ul>
    </TipBox>
  </div>
</template>

<script>
import KnowledgeCard from '@/components/content/KnowledgeCard.vue'
import TipBox from '@/components/content/TipBox.vue'
import CodeBlock from '@/components/demo/CodeBlock.vue'
import DemoBox from '@/components/demo/DemoBox.vue'
import scrollTrackingMixin from '@/utils/scrollTrackingMixin'

export default {
  name: 'VuexModules',
  
  mixins: [scrollTrackingMixin],
  
  components: {
    KnowledgeCard,
    TipBox,
    CodeBlock,
    DemoBox
  },
  
  data() {
    return {
      basicModule: `// store/modules/user.js
const userModule = {
  state: () => ({
    name: '',
    isLoggedIn: false
  }),
  
  mutations: {
    SET_NAME(state, name) {
      state.name = name
    },
    SET_LOGGED_IN(state, status) {
      state.isLoggedIn = status
    }
  },
  
  actions: {
    login({ commit }, username) {
      commit('SET_NAME', username)
      commit('SET_LOGGED_IN', true)
    }
  },
  
  getters: {
    displayName: state => state.name || 'æ¸¸å®¢'
  }
}

// store/index.js
const store = new Vuex.Store({
  modules: {
    user: userModule  // æ³¨å†Œæ¨¡å—
  }
})

// è®¿é—®æ¨¡å— state
store.state.user.name`,

      namespacedModule: `const userModule = {
  namespaced: true,  // å¼€å¯å‘½åç©ºé—´
  
  state: () => ({
    name: '',
    isLoggedIn: false
  }),
  
  mutations: {
    // å®é™…è·¯å¾„ï¼š'user/SET_NAME'
    SET_NAME(state, name) {
      state.name = name
    }
  },
  
  actions: {
    // å®é™…è·¯å¾„ï¼š'user/login'
    login({ commit }, username) {
      commit('SET_NAME', username)
    }
  },
  
  getters: {
    // å®é™…è·¯å¾„ï¼š'user/displayName'
    displayName: state => state.name || 'æ¸¸å®¢'
  }
}`,

      accessNamespaced: `// 1. åœ¨ç»„ä»¶ä¸­è®¿é—®å‘½åç©ºé—´æ¨¡å—
computed: {
  // ä½¿ç”¨å‘½åç©ºé—´å‰ç¼€
  ...mapState('user', ['name', 'isLoggedIn']),
  ...mapGetters('user', ['displayName'])
},
methods: {
  ...mapMutations('user', ['SET_NAME']),
  ...mapActions('user', ['login'])
}

// 2. ä½¿ç”¨ createNamespacedHelpers
import { createNamespacedHelpers } from 'vuex'
const { mapState, mapActions } = createNamespacedHelpers('user')

export default {
  computed: {
    ...mapState(['name', 'isLoggedIn'])
  },
  methods: {
    ...mapActions(['login'])
  }
}`
    }
  }
}
</script>

<style lang="scss" scoped>
.knowledge-page {
  max-width: 1000px;
  margin: 0 auto;
}

.concept-content {
  .metaphor {
    display: flex;
    gap: 16px;
    padding: 16px;
    background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
    border-radius: 12px;
    margin-bottom: 20px;
    
    .metaphor-icon {
      font-size: 32px;
    }
    
    .metaphor-text {
      font-size: 15px;
      line-height: 1.6;
    }
  }
  
  .definition-box {
    background: #f8f9fa;
    padding: 16px;
    border-radius: 8px;
    margin-bottom: 20px;
    
    h4 {
      margin-bottom: 8px;
      color: #1d1d1f;
    }
    
    p {
      color: #666;
      line-height: 1.6;
      margin-bottom: 8px;
      
      &:last-child {
        margin-bottom: 0;
      }
    }
  }
  
  .structure-box {
    background: #f8f9fa;
    padding: 16px;
    border-radius: 8px;
    
    h4 {
      margin-bottom: 12px;
      color: #1d1d1f;
    }
    
    .tree-structure {
      background: #1e1e1e;
      border-radius: 8px;
      padding: 16px;
      
      pre {
        margin: 0;
        color: #d4d4d4;
        font-family: 'SF Mono', monospace;
        font-size: 13px;
        line-height: 1.5;
      }
    }
  }
}

.syntax-section {
  h4 {
    margin-bottom: 12px;
    color: #1d1d1f;
    font-size: 15px;
    
    &:not(:first-child) {
      margin-top: 24px;
    }
  }
}
</style>

<template>
  <div class="knowledge-page">
    <!-- æ¦‚å¿µè¯´æ˜ -->
    <KnowledgeCard title="ğŸ“– ä»€ä¹ˆæ˜¯ Mutations">
      <div class="concept-content">
        <div class="metaphor">
          <div class="metaphor-icon">ğŸ”§</div>
          <div class="metaphor-text">
            <strong>é€šä¿—æ¯”å–»ï¼š</strong>Mutations å°±åƒ<strong>ä»“åº“ç®¡ç†å‘˜çš„æ“ä½œè®°å½•æœ¬</strong>ã€‚
            æ¯æ¬¡ä¿®æ”¹ä»“åº“ï¼ˆStateï¼‰çš„åº“å­˜ï¼Œéƒ½å¿…é¡»åœ¨æœ¬å­ä¸Šè®°å½•ä¸‹æ¥ï¼šè°ã€ä»€ä¹ˆæ—¶é—´ã€åšäº†ä»€ä¹ˆæ“ä½œã€‚
            è¿™æ ·ä»“åº“çš„å˜åŒ–å°±æœ‰æ®å¯æŸ¥äº†ï¼
          </div>
        </div>
        
        <div class="definition-box">
          <h4>ğŸ“š å®˜æ–¹å®šä¹‰</h4>
          <p><strong>Mutations</strong> æ˜¯æ›´æ”¹ Vuex store ä¸­ state çš„<strong>å”¯ä¸€æ–¹æ³•</strong>ã€‚</p>
          <p>æ¯ä¸ª mutation éƒ½æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„<strong>äº‹ä»¶ç±»å‹ï¼ˆtypeï¼‰</strong>å’Œä¸€ä¸ª<strong>å›è°ƒå‡½æ•°ï¼ˆhandlerï¼‰</strong>ã€‚</p>
        </div>
        
        <div class="key-rules">
          <h4>ğŸ”‘ æ ¸å¿ƒè§„åˆ™</h4>
          <div class="rule-grid">
            <div class="rule-item">
              <span class="rule-icon">1ï¸âƒ£</span>
              <div>
                <strong>å¿…é¡»æ˜¯åŒæ­¥å‡½æ•°</strong>
                <p>å¼‚æ­¥æ“ä½œè¯·ä½¿ç”¨ Actions</p>
              </div>
            </div>
            <div class="rule-item">
              <span class="rule-icon">2ï¸âƒ£</span>
              <div>
                <strong>ä½¿ç”¨ commit è§¦å‘</strong>
                <p>ä¸èƒ½ç›´æ¥è°ƒç”¨ mutation å‡½æ•°</p>
              </div>
            </div>
            <div class="rule-item">
              <span class="rule-icon">3ï¸âƒ£</span>
              <div>
                <strong>å¯ä»¥æºå¸¦ Payload</strong>
                <p>ä¼ é€’é¢å¤–å‚æ•°ç»™ mutation</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </KnowledgeCard>

    <!-- è¯­æ³•æ ¼å¼ -->
    <KnowledgeCard title="ğŸ“ è¯­æ³•æ ¼å¼">
      <div class="syntax-section">
        <h4>å®šä¹‰ Mutation</h4>
        <CodeBlock :code="defineMutation" language="javascript" />
        
        <h4>æäº¤ Mutation</h4>
        <CodeBlock :code="commitMutation" language="javascript" />
        
        <h4>å¸¦ Payload çš„ Mutation</h4>
        <CodeBlock :code="payloadMutation" language="javascript" />
        
        <h4>å¯¹è±¡é£æ ¼æäº¤</h4>
        <CodeBlock :code="objectStyleCommit" language="javascript" />
      </div>
    </KnowledgeCard>

    <!-- Demo: åŸºç¡€ç”¨æ³• -->
    <KnowledgeCard title="ğŸ¯ Demo 1: Mutations åŸºç¡€ç”¨æ³•">
      <DemoBox 
        demoPath="vuex/mutations-basic"
        title="è®¡æ•°å™¨å¢å‡"
        :height="'350px'"
      />
    </KnowledgeCard>

    <!-- Demo: Payload -->
    <KnowledgeCard title="ğŸ¯ Demo 2: Payload è½½è·">
      <DemoBox 
        demoPath="vuex/mutations-payload"
        title="å¸¦å‚æ•°çš„ Mutation"
        :height="'380px'"
      />
    </KnowledgeCard>

    <!-- Demo: å¯¹è±¡é£æ ¼ -->
    <KnowledgeCard title="ğŸ¯ Demo 3: å¯¹è±¡é£æ ¼æäº¤">
      <DemoBox 
        demoPath="vuex/mutations-object"
        title="ä½¿ç”¨å¯¹è±¡ä¼ é€’å¤šä¸ªå‚æ•°"
        :height="'350px'"
      />
    </KnowledgeCard>

    <!-- Demo: mapMutations -->
    <KnowledgeCard title="ğŸ¯ Demo 4: mapMutations è¾…åŠ©å‡½æ•°">
      <DemoBox 
        demoPath="vuex/mutations-map"
        title="ä½¿ç”¨ mapMutations ç®€åŒ–ä»£ç "
        :height="'400px'"
      />
    </KnowledgeCard>

    <!-- Demo: å¸¸é‡ç±»å‹ -->
    <KnowledgeCard title="ğŸ¯ Demo 5: ä½¿ç”¨å¸¸é‡å®šä¹‰ Mutation ç±»å‹">
      <DemoBox 
        demoPath="vuex/mutations-const"
        title="å¤§å‹é¡¹ç›®çš„æœ€ä½³å®è·µ"
        :height="'380px'"
      />
    </KnowledgeCard>

    <!-- ä¸ºä»€ä¹ˆå¿…é¡»åŒæ­¥ -->
    <TipBox type="info" title="ğŸ’¡ ä¸ºä»€ä¹ˆ Mutation å¿…é¡»æ˜¯åŒæ­¥çš„ï¼Ÿ">
      <p>Vuex çš„è®¾è®¡ç†å¿µæ˜¯<strong>å¯è¿½è¸ªçš„çŠ¶æ€å˜åŒ–</strong>ã€‚DevTools ä¼šåœ¨ mutation è§¦å‘æ—¶æ•è·çŠ¶æ€å¿«ç…§ã€‚</p>
      <p>å¦‚æœ mutation ä¸­æœ‰å¼‚æ­¥æ“ä½œï¼ŒDevTools æ— æ³•çŸ¥é“çŠ¶æ€ä½•æ—¶å˜åŒ–ï¼Œå¯¼è‡´è°ƒè¯•å›°éš¾ã€‚</p>
      <p>å¼‚æ­¥æ“ä½œåº”è¯¥æ”¾åœ¨ <strong>Actions</strong> ä¸­å¤„ç†ï¼</p>
    </TipBox>

    <!-- æ³¨æ„äº‹é¡¹ -->
    <TipBox type="warning" title="âš ï¸ æ³¨æ„äº‹é¡¹">
      <ul>
        <li><strong>ä¸è¦åœ¨ mutation ä¸­åšå¼‚æ­¥æ“ä½œï¼š</strong>setTimeoutã€Ajaxã€Promise ç­‰éƒ½ä¸è¡Œ</li>
        <li><strong>Payload æ¨èä½¿ç”¨å¯¹è±¡ï¼š</strong>ä¾¿äºä¼ é€’å¤šä¸ªå‚æ•°ï¼Œä¹Ÿæ›´æ˜“é˜…è¯»</li>
        <li><strong>å¤§å‹é¡¹ç›®ä½¿ç”¨å¸¸é‡ï¼š</strong>é¿å…æ‹¼å†™é”™è¯¯ï¼Œä¾¿äºæœç´¢å’Œæ›¿æ¢</li>
      </ul>
    </TipBox>

    <!-- æœ€ä½³å®è·µ -->
    <TipBox type="success" title="âœ… æœ€ä½³å®è·µ">
      <ul>
        <li>mutation å‘½åä½¿ç”¨å¤§å†™ + ä¸‹åˆ’çº¿ï¼š<code>SET_USER</code>ã€<code>ADD_TODO</code></li>
        <li>ä¸€ä¸ª mutation åªåšä¸€ä»¶äº‹ï¼Œä¿æŒç®€å•</li>
        <li>ä½¿ç”¨ <code>mapMutations</code> ç®€åŒ–ç»„ä»¶ä¸­çš„ä»£ç </li>
        <li>å¤æ‚é€»è¾‘æ”¾åœ¨ actions ä¸­ï¼Œmutation åªè´Ÿè´£å®é™…çš„çŠ¶æ€ä¿®æ”¹</li>
      </ul>
    </TipBox>
  </div>
</template>

<script>
import KnowledgeCard from '@/components/content/KnowledgeCard.vue'
import TipBox from '@/components/content/TipBox.vue'
import CodeBlock from '@/components/demo/CodeBlock.vue'
import DemoBox from '@/components/demo/DemoBox.vue'

export default {
  name: 'VuexMutations',
  
  components: {
    KnowledgeCard,
    TipBox,
    CodeBlock,
    DemoBox
  },
  
  data() {
    return {
      defineMutation: `const store = new Vuex.Store({
  state: {
    count: 0
  },
  mutations: {
    // mutation æ¥æ”¶ state ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°
    increment(state) {
      state.count++
    },
    decrement(state) {
      state.count--
    }
  }
})`,

      commitMutation: `// æ–¹å¼1ï¼šåœ¨ç»„ä»¶ä¸­æäº¤
this.$store.commit('increment')

// æ–¹å¼2ï¼šç›´æ¥åœ¨ store ä¸Šæäº¤
store.commit('increment')`,

      payloadMutation: `// å®šä¹‰å¸¦ payload çš„ mutation
mutations: {
  // payload æ˜¯ç¬¬äºŒä¸ªå‚æ•°
  incrementBy(state, n) {
    state.count += n
  },
  // payload æ¨èä½¿ç”¨å¯¹è±¡
  addTodo(state, payload) {
    state.todos.push({
      id: payload.id,
      text: payload.text,
      done: false
    })
  }
}

// æäº¤æ—¶ä¼ å…¥ payload
this.$store.commit('incrementBy', 10)
this.$store.commit('addTodo', { id: 1, text: 'å­¦ä¹  Vuex' })`,

      objectStyleCommit: `// å¯¹è±¡é£æ ¼æäº¤
// æ•´ä¸ªå¯¹è±¡ä½œä¸º payload ä¼ å…¥
this.$store.commit({
  type: 'addTodo',
  id: 1,
  text: 'å­¦ä¹  Vuex'
})

// mutation ä¸­é€šè¿‡ payload.xxx è®¿é—®
mutations: {
  addTodo(state, payload) {
    state.todos.push({
      id: payload.id,    // 1
      text: payload.text // 'å­¦ä¹  Vuex'
    })
  }
}`
    }
  }
}
</script>

<style lang="scss" scoped>
.knowledge-page {
  max-width: 1000px;
  margin: 0 auto;
}

.concept-content {
  .metaphor {
    display: flex;
    gap: 16px;
    padding: 16px;
    background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
    border-radius: 12px;
    margin-bottom: 20px;
    
    .metaphor-icon {
      font-size: 32px;
    }
    
    .metaphor-text {
      font-size: 15px;
      line-height: 1.6;
    }
  }
  
  .definition-box {
    background: #f8f9fa;
    padding: 16px;
    border-radius: 8px;
    margin-bottom: 20px;
    
    h4 {
      margin-bottom: 8px;
      color: #1d1d1f;
    }
    
    p {
      color: #666;
      line-height: 1.6;
      margin-bottom: 8px;
      
      &:last-child {
        margin-bottom: 0;
      }
    }
  }
  
  .key-rules {
    h4 {
      margin-bottom: 12px;
      color: #1d1d1f;
    }
    
    .rule-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
    }
    
    .rule-item {
      display: flex;
      gap: 12px;
      padding: 16px;
      background: #f0f0f5;
      border-radius: 8px;
      
      .rule-icon {
        font-size: 20px;
      }
      
      strong {
        display: block;
        margin-bottom: 4px;
        color: #1d1d1f;
      }
      
      p {
        font-size: 13px;
        color: #86868b;
        margin: 0;
      }
    }
  }
}

.syntax-section {
  h4 {
    margin-bottom: 12px;
    color: #1d1d1f;
    font-size: 15px;
    
    &:not(:first-child) {
      margin-top: 24px;
    }
  }
}
</style>

<template>
  <div class="knowledge-page">
    <h1>ğŸ“Š 9.1 State çŠ¶æ€</h1>
    
    <!-- æ¦‚å¿µè¯´æ˜ -->
    <KnowledgeCard title="ğŸ“– æ¦‚å¿µè¯´æ˜ï¼ˆæ˜¯ä»€ä¹ˆï¼‰">
      <div class="concept-content">
        <p class="analogy">
          <strong>é€šä¿—æ¯”å–»</strong>ï¼šState å°±åƒ<strong>ä»“åº“çš„è´§æ¶</strong>â€”â€”
          æ‰€æœ‰å•†å“ï¼ˆæ•°æ®ï¼‰éƒ½æ•´é½åœ°æ‘†æ”¾åœ¨è´§æ¶ä¸Šï¼Œä»»ä½•å‘˜å·¥ï¼ˆç»„ä»¶ï¼‰éƒ½å¯ä»¥æ¥æŸ¥çœ‹åº“å­˜ã€‚
        </p>
        <p class="definition">
          <strong>å®˜æ–¹å®šä¹‰</strong>ï¼šVuex ä½¿ç”¨<strong>å•ä¸€çŠ¶æ€æ ‘</strong>ï¼ˆSingle State Treeï¼‰ï¼Œ
          ç”¨ä¸€ä¸ªå¯¹è±¡åŒ…å«äº†å…¨éƒ¨çš„åº”ç”¨å±‚çº§çŠ¶æ€ï¼Œä½œä¸º"å”¯ä¸€æ•°æ®æº"ï¼ˆSSOTï¼‰å­˜åœ¨ã€‚
        </p>
      </div>
    </KnowledgeCard>

    <!-- ä¸ºä»€ä¹ˆéœ€è¦ -->
    <KnowledgeCard title="ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦ Vuex">
      <div class="why-content">
        <h4>ğŸ˜« æ²¡æœ‰ Vuex æ—¶çš„ç—›ç‚¹ï¼š</h4>
        <ul>
          <li>å¤šä¸ªç»„ä»¶å…±äº«çŠ¶æ€æ—¶ï¼Œéœ€è¦å±‚å±‚ä¼ é€’ props</li>
          <li>å…„å¼Ÿç»„ä»¶é€šä¿¡éœ€è¦å€ŸåŠ©çˆ¶ç»„ä»¶ä¸­è½¬ï¼Œä»£ç å¤æ‚</li>
          <li>è·¨å±‚çº§ç»„ä»¶é€šä¿¡æ›´åŠ å›°éš¾</li>
          <li>çŠ¶æ€åˆ†æ•£åœ¨å„ä¸ªç»„ä»¶ä¸­ï¼Œéš¾ä»¥è¿½è¸ªå’Œè°ƒè¯•</li>
        </ul>
        <h4>âœ… ä½¿ç”¨ Vuex çš„å¥½å¤„ï¼š</h4>
        <ul>
          <li><strong>é›†ä¸­ç®¡ç†</strong>ï¼šæ‰€æœ‰çŠ¶æ€å­˜æ”¾åœ¨ä¸€ä¸ªåœ°æ–¹</li>
          <li><strong>å¯é¢„æµ‹</strong>ï¼šçŠ¶æ€å˜åŒ–å¯è¿½è¸ªã€å¯è°ƒè¯•</li>
          <li><strong>ä»»æ„ç»„ä»¶è®¿é—®</strong>ï¼šä¸éœ€è¦å±‚å±‚ä¼ é€’</li>
        </ul>
      </div>
    </KnowledgeCard>

    <!-- è¯­æ³•æ ¼å¼ -->
    <KnowledgeCard title="ğŸ“ åŸºæœ¬è¯­æ³•">
      <CodeBlock :code="storeCode" language="javascript" />
      <p class="tip">State å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ï¼ˆåœ¨æ¨¡å—ä¸­ï¼‰ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚è¿™æ ·æ¯ä¸ªæ¨¡å—å®ä¾‹éƒ½æœ‰ç‹¬ç«‹çš„çŠ¶æ€ã€‚</p>
    </KnowledgeCard>

    <!-- è®¿é—® State -->
    <KnowledgeCard title="ğŸ” åœ¨ç»„ä»¶ä¸­è®¿é—® State">
      <h4>æ–¹å¼ä¸€ï¼šç›´æ¥è®¿é—®</h4>
      <CodeBlock :code="accessCode1" language="javascript" />
      
      <h4>æ–¹å¼äºŒï¼šcomputed è®¡ç®—å±æ€§</h4>
      <CodeBlock :code="accessCode2" language="javascript" />
      
      <h4>æ–¹å¼ä¸‰ï¼šmapState è¾…åŠ©å‡½æ•°ï¼ˆæ¨èï¼‰</h4>
      <CodeBlock :code="mapStateCode" language="javascript" />
    </KnowledgeCard>

    <!-- Demo å±•ç¤º -->
    <KnowledgeCard title="ğŸ¯ äº¤äº’æ¼”ç¤º">
      <DemoBox
        demoPath="vuex/state-basic"
        title="Demo 1: State åŸºç¡€ç”¨æ³•"
        :height="380"
      />
      <DemoBox
        demoPath="vuex/state-mapstate"
        title="Demo 2: mapState è¾…åŠ©å‡½æ•°"
        :height="420"
      />
      <DemoBox
        demoPath="vuex/state-spread"
        title="Demo 3: å±•å¼€è¿ç®—ç¬¦æ··åˆæœ¬åœ°è®¡ç®—å±æ€§"
        :height="400"
      />
      <DemoBox
        demoPath="vuex/state-module"
        title="Demo 4: æ¨¡å—ä¸­çš„ State"
        :height="450"
      />
      <DemoBox
        demoPath="vuex/state-reactive"
        title="Demo 5: å“åº”å¼åŸç†æ¼”ç¤º"
        :height="420"
      />
    </KnowledgeCard>

    <!-- æ³¨æ„äº‹é¡¹ -->
    <TipBox type="warning" title="âš ï¸ æ³¨æ„äº‹é¡¹">
      <ul>
        <li><strong>ä¸è¦ç›´æ¥ä¿®æ”¹ Stateï¼š</strong>å¿…é¡»é€šè¿‡ mutation æ¥ä¿®æ”¹ï¼Œå¦åˆ™æ— æ³•è¿½è¸ªçŠ¶æ€å˜åŒ–</li>
        <li><strong>æ¨¡å—ä¸­ State å¿…é¡»æ˜¯å‡½æ•°ï¼š</strong>é¿å…å¤šä¸ªæ¨¡å—å®ä¾‹å…±äº«åŒä¸€ä¸ªå¯¹è±¡</li>
        <li><strong>ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦ï¼š</strong>mapState è¿”å›å¯¹è±¡ï¼Œéœ€è¦ç”¨ ... å±•å¼€åˆ° computed ä¸­</li>
      </ul>
    </TipBox>

    <!-- æœ€ä½³å®è·µ -->
    <TipBox type="info" title="ğŸ’¡ æœ€ä½³å®è·µ">
      <ul>
        <li>ä¼˜å…ˆä½¿ç”¨ <code>mapState</code> è¾…åŠ©å‡½æ•°ï¼Œä»£ç æ›´ç®€æ´</li>
        <li>State ä¸­åªå­˜æ”¾éœ€è¦å…±äº«çš„æ•°æ®ï¼Œç»„ä»¶ç§æœ‰æ•°æ®æ”¾åœ¨ç»„ä»¶çš„ data ä¸­</li>
        <li>å¤æ‚åº”ç”¨ä½¿ç”¨æ¨¡å—åŒ–ç»„ç»‡ State</li>
        <li>ä½¿ç”¨ Vue DevTools è°ƒè¯• Vuex çŠ¶æ€å˜åŒ–</li>
      </ul>
    </TipBox>
  </div>
</template>

<script>
import KnowledgeCard from '@/components/content/KnowledgeCard.vue'
import TipBox from '@/components/content/TipBox.vue'
import CodeBlock from '@/components/demo/CodeBlock.vue'
import DemoBox from '@/components/demo/DemoBox.vue'
import scrollTrackingMixin from '@/utils/scrollTrackingMixin'

export default {
  name: 'VuexState',
  mixins: [scrollTrackingMixin],
  components: {
    KnowledgeCard,
    TipBox,
    CodeBlock,
    DemoBox
  },
  data() {
    return {
      storeCode: `// store/index.js
import Vue from 'vue'
import Vuex from 'vuex'

Vue.use(Vuex)

export default new Vuex.Store({
  state: {
    // è¿™é‡Œå®šä¹‰å…±äº«çŠ¶æ€
    count: 0,
    user: {
      name: 'å¼ ä¸‰',
      age: 25
    },
    todos: [
      { id: 1, text: 'å­¦ä¹  Vuex', done: true },
      { id: 2, text: 'å­¦ä¹  Vue Router', done: false }
    ]
  }
})`,
      accessCode1: `// æ–¹å¼ä¸€ï¼šç›´æ¥è®¿é—®ï¼ˆä¸æ¨èï¼Œä»£ç å†—é•¿ï¼‰
export default {
  computed: {
    count() {
      return this.$store.state.count
    }
  }
}`,
      accessCode2: `// æ–¹å¼äºŒï¼šcomputed è®¡ç®—å±æ€§
export default {
  computed: {
    count() {
      return this.$store.state.count
    },
    userName() {
      return this.$store.state.user.name
    }
  }
}`,
      mapStateCode: `// æ–¹å¼ä¸‰ï¼šmapState è¾…åŠ©å‡½æ•°ï¼ˆæ¨èï¼‰
import { mapState } from 'vuex'

export default {
  computed: {
    // ä½¿ç”¨å¯¹è±¡å±•å¼€è¿ç®—ç¬¦å°† mapState æ··å…¥ computed
    ...mapState({
      // ç®­å¤´å‡½æ•°å†™æ³•
      count: state => state.count,
      // å­—ç¬¦ä¸²å†™æ³•ï¼Œç­‰åŒäº state => state.user
      user: 'user',
      // æ™®é€šå‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨ this è®¿é—®æœ¬åœ°æ•°æ®
      countPlusLocal(state) {
        return state.count + this.localCount
      }
    }),
    
    // æ•°ç»„å†™æ³•ï¼šå±æ€§åä¸ state é”®åç›¸åŒæ—¶
    ...mapState(['count', 'user', 'todos'])
  }
}`
    }
  }
}
</script>

<style lang="scss" scoped>
@import '@/assets/styles/_variables.scss';
@import '@/assets/styles/_mixins.scss';

.knowledge-page {
  max-width: 900px;
  
  h1 {
    font-size: $font-size-2xl;
    margin-bottom: $spacing-lg;
    .icon { font-size: 36px; }
  }
}

.concept-content {
  .analogy {
    background: linear-gradient(135deg, rgba($color-primary, 0.1), rgba($color-primary-light, 0.1));
    padding: $spacing-md;
    border-radius: $radius-md;
    margin-bottom: $spacing-md;
  }
  
  .definition {
    color: $color-text-secondary;
  }
}

.why-content {
  h4 {
    margin: $spacing-md 0 $spacing-sm;
    &:first-child { margin-top: 0; }
  }
  
  ul {
    padding-left: $spacing-lg;
    
    li {
      margin-bottom: $spacing-xs;
    }
  }
}

.tip {
  margin-top: $spacing-sm;
  padding: $spacing-sm;
  background: rgba($color-info, 0.1);
  border-radius: $radius-sm;
  font-size: $font-size-sm;
  color: $color-text-secondary;
}
</style>
